  {
    key_type rsa4096
}

http://mirror.sjtu.edu.cn/ {
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    redir / https://mirror.sjtu.edu.cn/ 308
}

http://mirror.sjtu.edu.cn/centos {
    redir /centos /centos/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://mirror.sjtu.edu.cn/centos/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://mirror.sjtu.edu.cn/debian {
    redir /debian /debian/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://mirror.sjtu.edu.cn/debian/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://mirror.sjtu.edu.cn/debian-security {
    redir /debian-security /debian-security/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://mirror.sjtu.edu.cn/debian-security/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://mirror.sjtu.edu.cn/deepin {
    redir /deepin /deepin/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://mirror.sjtu.edu.cn/deepin/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://mirror.sjtu.edu.cn/docker-ce {
    redir /docker-ce /docker-ce/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://mirror.sjtu.edu.cn/docker-ce/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk2
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://mirror.sjtu.edu.cn/fedora-secondary {
    redir /fedora-secondary /fedora-secondary/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://mirror.sjtu.edu.cn/fedora-secondary/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://mirror.sjtu.edu.cn/opensuse {
    redir /opensuse /opensuse/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://mirror.sjtu.edu.cn/opensuse/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://mirror.sjtu.edu.cn/remi {
    redir /remi /remi/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://mirror.sjtu.edu.cn/remi/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk2
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://mirror.sjtu.edu.cn/ubuntu {
    redir /ubuntu /ubuntu/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://mirror.sjtu.edu.cn/ubuntu/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk2
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://mirror.sjtu.edu.cn/ubuntu-ports {
    redir /ubuntu-ports /ubuntu-ports/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://mirror.sjtu.edu.cn/ubuntu-ports/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk2
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://mirror.sjtu.edu.cn/openwrt {
    redir /openwrt /openwrt/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://mirror.sjtu.edu.cn/openwrt/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://mirror.sjtu.edu.cn/rpmfusion {
    redir /rpmfusion /rpmfusion/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://mirror.sjtu.edu.cn/rpmfusion/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

k8s-gcr-io.siyuan.internal.sjtug.org {
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    reverse_proxy siyuan-gcr-registry:80 {
        header_up Host {http.reverse_proxy.upstream.hostport}
    }
    header * x-sjtug-mirror-id siyuan
}

docker.siyuan.internal.sjtug.org {
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    reverse_proxy siyuan-docker-registry:80 {
        header_up Host {http.reverse_proxy.upstream.hostport}
    }
    header * x-sjtug-mirror-id siyuan
}

http://mirror.sjtu.edu.cn/fedora {
    redir /fedora /fedora/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://mirror.sjtu.edu.cn/fedora/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

mirror.sjtu.edu.cn {
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }

    file_server /* {
        root /dists
    }
    rewrite /docs/* /  # for react app

    reverse_proxy /lug/* lug:7001 {
        header_down Access-Control-Allow-Origin *
        header_down Access-Control-Request-Method GET
    }

    basicauth /monitor/* {
        {$MONITOR_USER} {$MONITOR_PASSWORD_HASHED}
    }
    route /monitor/node_exporter/* {
        uri strip_prefix /monitor/node_exporter
        reverse_proxy 172.31.0.1:9100
    }
    route /monitor/cadvisor/* {
        uri strip_prefix /monitor/cadvisor
        reverse_proxy cadvisor:8080
    }
    route /monitor/lug/* {
        uri strip_prefix /monitor/lug
        reverse_proxy lug:8081
    }
    route /monitor/mirror-intel/* {
        uri strip_prefix /monitor/mirror-intel
        reverse_proxy mirror-intel:8000
    }
    route /monitor/docker-gcr/* {
        uri strip_prefix /monitor/docker-gcr
        reverse_proxy siyuan-gcr-registry:5001
    }
    route /monitor/docker-registry/* {
        uri strip_prefix /monitor/docker-registry
        reverse_proxy siyuan-docker-registry:5001
    }

    @hidden {
        path */.*
    }
    respond @hidden 404
    @reject_lug_api {
        path /lug/v1/admin/*
    }
    respond @reject_lug_api 403

    header * x-sjtug-mirror-id siyuan
    header /mirrorz/* Access-Control-Allow-Origin *
    header /mirrorz/* Access-Control-Request-Method GET

    redir /centos /centos/ 301
    file_server /centos/* browse {
        root /srv/disk1
        hide .*
    }
    redir /debian /debian/ 301
    file_server /debian/* browse {
        root /srv/disk1
        hide .*
    }
    redir /debian-cd /debian-cd/ 301
    file_server /debian-cd/* browse {
        root /srv/disk1
        hide .*
    }
    redir /debian-security /debian-security/ 301
    file_server /debian-security/* browse {
        root /srv/disk1
        hide .*
    }
    redir /deepin /deepin/ 301
    file_server /deepin/* browse {
        root /srv/disk1
        hide .*
    }
    redir /deepin-cd /deepin-cd/ 301
    file_server /deepin-cd/* browse {
        root /srv/disk1
        hide .*
    }
    redir /docker-ce /docker-ce/ 301
    file_server /docker-ce/* browse {
        root /srv/disk2
        hide .*
    }
    redir /fedora-secondary /fedora-secondary/ 301
    file_server /fedora-secondary/* browse {
        root /srv/disk1
        hide .*
    }
    redir /linuxmint /linuxmint/ 301
    file_server /linuxmint/* browse {
        root /srv/disk1
        hide .*
    }
    redir /linuxmint-cd /linuxmint-cd/ 301
    file_server /linuxmint-cd/* browse {
        root /srv/disk1
        hide .*
    }
    redir /mageia /mageia/ 301
    file_server /mageia/* browse {
        root /srv/disk2
        hide .*
    }
    redir /opensuse /opensuse/ 301
    file_server /opensuse/* browse {
        root /srv/disk1
        hide .*
    }
    redir /openvz /openvz/ 301
    file_server /openvz/* browse {
        root /srv/disk2
        hide .*
    }
    redir /remi /remi/ 301
    file_server /remi/* browse {
        root /srv/disk2
        hide .*
    }
    redir /scientific /scientific/ 301
    file_server /scientific/* browse {
        root /srv/disk2
        hide .*
    }
    redir /ubuntu /ubuntu/ 301
    file_server /ubuntu/* browse {
        root /srv/disk2
        hide .*
    }
    redir /ubuntu-cd /ubuntu-cd/ 301
    file_server /ubuntu-cd/* browse {
        root /srv/disk2
        hide .*
    }
    redir /ubuntu-cdimage /ubuntu-cdimage/ 301
    file_server /ubuntu-cdimage/* browse {
        root /srv/disk2
        hide .*
    }
    redir /ubuntu-ports /ubuntu-ports/ 301
    file_server /ubuntu-ports/* browse {
        root /srv/disk2
        hide .*
    }
    redir /openwrt /openwrt/ 301
    file_server /openwrt/* browse {
        root /srv/disk1
        hide .*
    }
    redir /rpmfusion /rpmfusion/ 301
    file_server /rpmfusion/* browse {
        root /srv/disk1
        hide .*
    }
    redir /homebrew-bottles /homebrew-bottles/ 301
    route /homebrew-bottles/* {
        reverse_proxy mirror-intel:8000
    }
    redir /rust-static /rust-static/ 301
    route /rust-static/* {
        reverse_proxy mirror-intel:8000
    }
    redir /pypi-packages /pypi-packages/ 301
    route /pypi-packages/* {
        reverse_proxy mirror-intel:8000
    }
    redir /dart-pub /dart-pub/ 301
    route /dart-pub/* {
        reverse_proxy mirror-intel:8000
    }
    redir /pytorch-wheels /pytorch-wheels/ 301
    route /pytorch-wheels/* {
        reverse_proxy mirror-intel:8000
    }
    redir /crates.io /crates.io/ 301
    route /crates.io/* {
        reverse_proxy mirror-intel:8000
    }
    redir /flutter_infra /flutter_infra/ 301
    route /flutter_infra/* {
        reverse_proxy mirror-intel:8000
    }
    redir /git/linuxbrew-core.git /git/linuxbrew-core.git/ 301
    redir /git/homebrew-services.git /git/homebrew-services.git/ 301
    redir /git/homebrew-cask-drivers.git /git/homebrew-cask-drivers.git/ 301
    redir /git/homebrew-cask-fonts.git /git/homebrew-cask-fonts.git/ 301
    redir /git/homebrew-cask-versions.git /git/homebrew-cask-versions.git/ 301
    redir /linuxbrew-bottles /linuxbrew-bottles/ 301
    route /linuxbrew-bottles/* {
        reverse_proxy mirror-intel:8000
    }
    redir /git/guix.git /git/guix.git/ 301
    redir /git/llvm-project.git /git/llvm-project.git/ 301
    redir /git/flutter-sdk.git /git/flutter-sdk.git/ 301
    redir /apache /apache/ 301
    file_server /apache/* browse {
        root /srv/disk2
        hide .*
    }
    redir /git/ohmyzsh.git /git/ohmyzsh.git/ 301
    redir /git/spacemacs.git /git/spacemacs.git/ 301
    redir /git/doom-emacs.git /git/doom-emacs.git/ 301
    redir /blackarch /blackarch/ 301
    file_server /blackarch/* browse {
        root /srv/disk2
        hide .*
    }
    redir /github/GNS3 /github/GNS3/ 301
    route /github/GNS3/* {
        uri strip_prefix /github/GNS3
        redir * /github-release/GNS3/gns3-gui/releases/download/?mirror_intel_list 302
    }
    redir /github/FreeCAD /github/FreeCAD/ 301
    route /github/FreeCAD/* {
        uri strip_prefix /github/FreeCAD
        redir * /github-release/FreeCAD/FreeCAD/releases/download/?mirror_intel_list 302
    }
    redir /github/prometheus /github/prometheus/ 301
    route /github/prometheus/* {
        uri strip_prefix /github/prometheus
        redir * /github-release/prometheus/?mirror_intel_list 302
    }
    redir /github/rubyinstaller2 /github/rubyinstaller2/ 301
    route /github/rubyinstaller2/* {
        uri strip_prefix /github/rubyinstaller2
        redir * /github-release/oneclick/rubyinstaller2/releases/download/?mirror_intel_list 302
    }
    redir /github/PowerShell /github/PowerShell/ 301
    route /github/PowerShell/* {
        uri strip_prefix /github/PowerShell
        redir * /github-release/PowerShell/PowerShell/releases/download/?mirror_intel_list 302
    }
    redir /sites/tldp.org /sites/tldp.org/ 301
    file_server /sites/tldp.org/* browse {
        root /srv/disk1
        hide .*
    }
    redir /nix-channels/store /nix-channels/store/ 301
    route /nix-channels/store/* {
        reverse_proxy mirror-intel:8000
    }
    redir /guix /guix/ 301
    route /guix/* {
        reverse_proxy mirror-intel:8000
    }
    redir /sjtug-internal /sjtug-internal/ 301
    route /sjtug-internal/* {
        reverse_proxy mirror-intel:8000
    }
    redir /fedora-ostree /fedora-ostree/ 301
    route /fedora-ostree/* {
        reverse_proxy mirror-intel:8000
    }
    redir /fedora-iot /fedora-iot/ 301
    route /fedora-iot/* {
        reverse_proxy mirror-intel:8000
    }
    redir /flathub /flathub/ 301
    route /flathub/* {
        reverse_proxy mirror-intel:8000
    }
    redir /github-release /github-release/ 301
    route /github-release/* {
        reverse_proxy mirror-intel:8000
    }
    redir /npm-registry /npm-registry/ 301
    route /npm-registry/* {
        uri strip_prefix /npm-registry
        redir * https://registry.npmjs.org{uri} 302
    }
    redir /nodejs-release /nodejs-release/ 301
    route /nodejs-release/* {
        uri strip_prefix /nodejs-release
        redir * https://nodejs.org/dist{uri} 302
    }
    redir /maven-central /maven-central/ 301
    route /maven-central/* {
        uri strip_prefix /maven-central
        redir * https://repo.maven.apache.org/maven2{uri} 302
    }
    redir /gcr-registry-siyuan /gcr-registry-siyuan/ 301
    route /gcr-registry-siyuan/* {
        uri strip_prefix /gcr-registry-siyuan
        reverse_proxy siyuan-gcr-registry:80 {
            header_up Host {http.reverse_proxy.upstream.hostport}
        }
    }
    redir /docker-registry-siyuan /docker-registry-siyuan/ 301
    route /docker-registry-siyuan/* {
        uri strip_prefix /docker-registry-siyuan
        reverse_proxy siyuan-docker-registry:80 {
            header_up Host {http.reverse_proxy.upstream.hostport}
        }
    }
    redir /sury /sury/ 301
    file_server /sury/* browse {
        root /srv/disk1
        hide .*
    }
    redir /opam-cache /opam-cache/ 301
    route /opam-cache/* {
        reverse_proxy mirror-intel:8000
    }
    redir /pypi/web/simple /pypi/web/simple/ 301
    route /pypi/web/simple/* {
        reverse_proxy mirror-intel:8000
    }
    redir /git/dpdk.git /git/dpdk.git/ 301
    redir /gradle/distributions /gradle/distributions/ 301
    route /gradle/distributions/* {
        reverse_proxy mirror-intel:8000
    }
    redir /dragonflybsd /dragonflybsd/ 301
    file_server /dragonflybsd/* browse {
        root /srv/disk2
        hide .*
    }
    redir /git/homebrew-install.git /git/homebrew-install.git/ 301
    redir /openeuler /openeuler/ 301
    file_server /openeuler/* browse {
        root /srv/disk1
        hide .*
    }
    redir /fedora /fedora/ 301
    file_server /fedora/* browse {
        root /srv/disk1
        hide .*
    }
    redir /manjaro /manjaro/ 301
    file_server /manjaro/* browse {
        root /srv/disk2
        hide .*
    }
    redir /manjarostable /manjarostable/ 301
    route /manjarostable/* {
        uri strip_prefix /manjarostable
        redir * https://mirror.sjtu.edu.cn/manjaro/stable{uri} 302
    }
    redir /voidlinux /voidlinux/ 301
    route /voidlinux/* {
        reverse_proxy mirror-intel:8000
    }
    redir /archlinux /archlinux/ 301
    file_server /archlinux/* browse {
        root /srv/disk2
        hide .*
    }
    redir /bioconductor /bioconductor/ 301
    route /bioconductor/* {
        reverse_proxy mirror-intel:8000
    }
    redir /wireshark /wireshark/ 301
    route /wireshark/* {
        reverse_proxy mirror-intel:8000
    }
    redir /test /test/ 301
    file_server /test/* browse {
        root /srv/disk1
        hide .*
    }
    redir /macports /macports/ 301
    route /macports/* {
        reverse_proxy mirror-intel:8000
    }
    redir /github/vscodium /github/vscodium/ 301
    route /github/vscodium/* {
        uri strip_prefix /github/vscodium
        redir * /github-release/VSCodium/vscodium/releases/download/?mirror_intel_list 302
    }
    redir /gimp /gimp/ 301
    route /gimp/* {
        reverse_proxy mirror-intel:8000
    }
    redir /flutter_infra_release /flutter_infra_release/ 301
    route /flutter_infra_release/* {
        uri strip_prefix /flutter_infra_release
        redir * https://mirror.sjtu.edu.cn/flutter_infra{uri} 302
    }
    redir /anaconda /anaconda/ 301
    route /anaconda/* {
        reverse_proxy mirror-intel:8000
    }
    redir /putty /putty/ 301
    route /putty/* {
        uri strip_prefix /putty
        redir * https://mirrors.sjtug.sjtu.edu.cn/putty{uri} 302
    }
    redir /archlinux-cn /archlinux-cn/ 301
    route /archlinux-cn/* {
        uri strip_prefix /archlinux-cn
        redir * https://mirrors.sjtug.sjtu.edu.cn/archlinux-cn{uri} 302
    }
    redir /archlinuxarm /archlinuxarm/ 301
    route /archlinuxarm/* {
        uri strip_prefix /archlinuxarm
        redir * https://mirrors.sjtug.sjtu.edu.cn/archlinuxarm{uri} 302
    }
    redir /gentoo /gentoo/ 301
    route /gentoo/* {
        uri strip_prefix /gentoo
        redir * https://mirrors.sjtug.sjtu.edu.cn/gentoo{uri} 302
    }
    redir /vim /vim/ 301
    route /vim/* {
        uri strip_prefix /vim
        redir * https://mirrors.sjtug.sjtu.edu.cn/vim{uri} 302
    }
    redir /alpine /alpine/ 301
    route /alpine/* {
        uri strip_prefix /alpine
        redir * https://mirrors.sjtug.sjtu.edu.cn/alpine{uri} 302
    }
    redir /cpan /cpan/ 301
    route /cpan/* {
        uri strip_prefix /cpan
        redir * https://mirrors.sjtug.sjtu.edu.cn/cpan{uri} 302
    }
    redir /cran /cran/ 301
    route /cran/* {
        uri strip_prefix /cran
        redir * https://mirrors.sjtug.sjtu.edu.cn/cran{uri} 302
    }
    redir /ctex /ctex/ 301
    route /ctex/* {
        uri strip_prefix /ctex
        redir * https://mirrors.sjtug.sjtu.edu.cn/ctex{uri} 302
    }
    redir /gnu /gnu/ 301
    route /gnu/* {
        uri strip_prefix /gnu
        redir * https://mirrors.sjtug.sjtu.edu.cn/gnu{uri} 302
    }
    redir /cygwin /cygwin/ 301
    route /cygwin/* {
        uri strip_prefix /cygwin
        redir * https://mirrors.sjtug.sjtu.edu.cn/cygwin{uri} 302
    }
    redir /ros /ros/ 301
    route /ros/* {
        uri strip_prefix /ros
        redir * https://mirrors.sjtug.sjtu.edu.cn/ros{uri} 302
    }
    redir /kali /kali/ 301
    route /kali/* {
        uri strip_prefix /kali
        redir * https://mirrors.sjtug.sjtu.edu.cn/kali{uri} 302
    }
    redir /kali-images /kali-images/ 301
    route /kali-images/* {
        uri strip_prefix /kali-images
        redir * https://mirrors.sjtug.sjtu.edu.cn/kali-images{uri} 302
    }
    redir /git/homebrew-core.git /git/homebrew-core.git/ 301
    redir /git/homebrew-cask.git /git/homebrew-cask.git/ 301
    redir /git/brew.git /git/brew.git/ 301
    redir /git/crates.io-index /git/crates.io-index/ 301
    redir /raspbian /raspbian/ 301
    route /raspbian/* {
        uri strip_prefix /raspbian
        redir * https://mirrors.sjtug.sjtu.edu.cn/raspbian{uri} 302
    }
    redir /parrot /parrot/ 301
    route /parrot/* {
        uri strip_prefix /parrot
        redir * https://mirrors.sjtug.sjtu.edu.cn/parrot{uri} 302
    }
    redir /raspberrypi /raspberrypi/ 301
    route /raspberrypi/* {
        uri strip_prefix /raspberrypi
        redir * https://mirrors.sjtug.sjtu.edu.cn/raspberrypi{uri} 302
    }
    redir /mx-isos /mx-isos/ 301
    route /mx-isos/* {
        uri strip_prefix /mx-isos
        redir * https://mirrors.sjtug.sjtu.edu.cn/mx-isos{uri} 302
    }
    redir /mx-packages /mx-packages/ 301
    route /mx-packages/* {
        uri strip_prefix /mx-packages
        redir * https://mirrors.sjtug.sjtu.edu.cn/mx-packages{uri} 302
    }
    redir /packagist /packagist/ 301
    route /packagist/* {
        uri strip_prefix /packagist
        redir * https://mirrors.sjtug.sjtu.edu.cn/packagist{uri} 302
    }
    redir /mongodb /mongodb/ 301
    route /mongodb/* {
        uri strip_prefix /mongodb
        redir * https://mirrors.sjtug.sjtu.edu.cn/mongodb{uri} 302
    }
    redir /qt /qt/ 301
    route /qt/* {
        uri strip_prefix /qt
        redir * https://mirrors.sjtug.sjtu.edu.cn/qt{uri} 302
    }
    redir /julia /julia/ 301
    route /julia/* {
        uri strip_prefix /julia
        redir * https://mirrors.sjtug.sjtu.edu.cn/julia{uri} 302
    }
    redir /emacs-elpa /emacs-elpa/ 301
    route /emacs-elpa/* {
        uri strip_prefix /emacs-elpa
        redir * https://mirrors.sjtug.sjtu.edu.cn/emacs-elpa{uri} 302
    }
    redir /julia-releases /julia-releases/ 301
    route /julia-releases/* {
        uri strip_prefix /julia-releases
        redir * https://mirrors.sjtug.sjtu.edu.cn/julia-releases{uri} 302
    }
    redir /raspberry-pi-os-images /raspberry-pi-os-images/ 301
    route /raspberry-pi-os-images/* {
        uri strip_prefix /raspberry-pi-os-images
        redir * https://mirrors.sjtug.sjtu.edu.cn/raspberry-pi-os-images{uri} 302
    }
    redir /msys2 /msys2/ 301
    route /msys2/* {
        uri strip_prefix /msys2
        redir * https://mirrors.sjtug.sjtu.edu.cn/msys2{uri} 302
    }
    redir /git/opam-repository.git /git/opam-repository.git/ 301
    redir /git/qemu.git /git/qemu.git/ 301
    redir /git/linux.git /git/linux.git/ 301
    redir /linuxliteos /linuxliteos/ 301
    route /linuxliteos/* {
        uri strip_prefix /linuxliteos
        redir * https://mirrors.sjtug.sjtu.edu.cn/linuxliteos{uri} 302
    }
    redir /download.flutter.io /download.flutter.io/ 301
    route /download.flutter.io/* {
        uri strip_prefix /download.flutter.io
        redir * https://mirrors.sjtug.sjtu.edu.cn/download.flutter.io{uri} 302
    }
    redir /google-fonts /google-fonts/ 301
    route /google-fonts/* {
        uri strip_prefix /google-fonts
        redir * https://fonts.googleapis.com{uri} 302
    }
    redir /CPAN /CPAN/ 301
    route /CPAN/* {
        uri strip_prefix /CPAN
        redir * https://mirrors.sjtug.sjtu.edu.cn/CPAN{uri} 302
    }
    redir /CRAN /CRAN/ 301
    route /CRAN/* {
        uri strip_prefix /CRAN
        redir * https://mirrors.sjtug.sjtu.edu.cn/CRAN{uri} 302
    }
    redir /CTAN /CTAN/ 301
    route /CTAN/* {
        uri strip_prefix /CTAN
        redir * https://mirrors.sjtug.sjtu.edu.cn/CTAN{uri} 302
    }
    redir /ctan /ctan/ 301
    route /ctan/* {
        uri strip_prefix /ctan
        redir * https://mirrors.sjtug.sjtu.edu.cn/ctan{uri} 302
    }

    @git_libgit2 {
        path /git/*
        header User-Agent *libgit2*
    }
    reverse_proxy @git_libgit2 git-backend
    @git_normal {
        path /git/*
        not header User-Agent *libgit2*
    }
    route @git_normal {
        route /git/linuxbrew-core.git/* {
            reverse_proxy git-backend
        }
        route /git/homebrew-services.git/* {
            reverse_proxy git-backend
        }
        route /git/homebrew-cask-drivers.git/* {
            reverse_proxy git-backend
        }
        route /git/homebrew-cask-fonts.git/* {
            reverse_proxy git-backend
        }
        route /git/homebrew-cask-versions.git/* {
            reverse_proxy git-backend
        }
        route /git/guix.git/* {
            reverse_proxy git-backend
        }
        route /git/llvm-project.git/* {
            reverse_proxy git-backend
        }
        route /git/flutter-sdk.git/* {
            reverse_proxy git-backend
        }
        route /git/ohmyzsh.git/* {
            reverse_proxy git-backend
        }
        route /git/spacemacs.git/* {
            reverse_proxy git-backend
        }
        route /git/doom-emacs.git/* {
            reverse_proxy git-backend
        }
        route /git/dpdk.git/* {
            reverse_proxy git-backend
        }
        route /git/homebrew-install.git/* {
            reverse_proxy git-backend
        }
        route /git/homebrew-core.git/* {
            uri strip_prefix /git/homebrew-core.git
            redir * https://mirrors.sjtug.sjtu.edu.cn/git/homebrew-core.git{uri} 302
        }
        route /git/homebrew-cask.git/* {
            uri strip_prefix /git/homebrew-cask.git
            redir * https://mirrors.sjtug.sjtu.edu.cn/git/homebrew-cask.git{uri} 302
        }
        route /git/brew.git/* {
            uri strip_prefix /git/brew.git
            redir * https://mirrors.sjtug.sjtu.edu.cn/git/brew.git{uri} 302
        }
        route /git/crates.io-index/* {
            uri strip_prefix /git/crates.io-index
            redir * https://mirrors.sjtug.sjtu.edu.cn/git/crates.io-index{uri} 302
        }
        route /git/opam-repository.git/* {
            uri strip_prefix /git/opam-repository.git
            redir * https://mirrors.sjtug.sjtu.edu.cn/git/opam-repository.git{uri} 302
        }
        route /git/qemu.git/* {
            uri strip_prefix /git/qemu.git
            redir * https://mirrors.sjtug.sjtu.edu.cn/git/qemu.git{uri} 302
        }
        route /git/linux.git/* {
            uri strip_prefix /git/linux.git
            redir * https://mirrors.sjtug.sjtu.edu.cn/git/linux.git{uri} 302
        }
    }
    @gzip_enabled {
        not path /speedtest/*
        not path /homebrew-bottles/*
        not path /rust-static/*
        not path /pypi-packages/*
        not path /dart-pub/*
        not path /pytorch-wheels/*
        not path /crates.io/*
        not path /flutter_infra/*
        not path /git/linuxbrew-core.git/*
        not path /git/homebrew-services.git/*
        not path /git/homebrew-cask-drivers.git/*
        not path /git/homebrew-cask-fonts.git/*
        not path /git/homebrew-cask-versions.git/*
        not path /linuxbrew-bottles/*
        not path /git/guix.git/*
        not path /git/llvm-project.git/*
        not path /git/flutter-sdk.git/*
        not path /git/ohmyzsh.git/*
        not path /git/spacemacs.git/*
        not path /git/doom-emacs.git/*
        not path /github/GNS3/*
        not path /github/FreeCAD/*
        not path /github/prometheus/*
        not path /github/rubyinstaller2/*
        not path /github/PowerShell/*
        not path /nix-channels/store/*
        not path /guix/*
        not path /sjtug-internal/*
        not path /fedora-ostree/*
        not path /fedora-iot/*
        not path /flathub/*
        not path /github-release/*
        not path /npm-registry/*
        not path /nodejs-release/*
        not path /maven-central/*
        not path /gcr-registry-siyuan/*
        not path /docker-registry-siyuan/*
        not path /opam-cache/*
        not path /pypi/web/simple/*
        not path /git/dpdk.git/*
        not path /gradle/distributions/*
        not path /git/homebrew-install.git/*
        not path /manjarostable/*
        not path /voidlinux/*
        not path /bioconductor/*
        not path /wireshark/*
        not path /macports/*
        not path /github/vscodium/*
        not path /gimp/*
        not path /flutter_infra_release/*
        not path /anaconda/*
        not path /putty/*
        not path /archlinux-cn/*
        not path /archlinuxarm/*
        not path /gentoo/*
        not path /vim/*
        not path /alpine/*
        not path /cpan/*
        not path /cran/*
        not path /ctex/*
        not path /gnu/*
        not path /cygwin/*
        not path /ros/*
        not path /kali/*
        not path /kali-images/*
        not path /git/homebrew-core.git/*
        not path /git/homebrew-cask.git/*
        not path /git/brew.git/*
        not path /git/crates.io-index/*
        not path /raspbian/*
        not path /parrot/*
        not path /raspberrypi/*
        not path /mx-isos/*
        not path /mx-packages/*
        not path /packagist/*
        not path /mongodb/*
        not path /qt/*
        not path /julia/*
        not path /emacs-elpa/*
        not path /julia-releases/*
        not path /raspberry-pi-os-images/*
        not path /msys2/*
        not path /git/opam-repository.git/*
        not path /git/qemu.git/*
        not path /git/linux.git/*
        not path /linuxliteos/*
        not path /download.flutter.io/*
        not path /google-fonts/*
        not path /CPAN/*
        not path /CRAN/*
        not path /CTAN/*
        not path /ctan/*
    }
    encode @gzip_enabled gzip zstd
    redir /speedtest /speedtest/ 308
    route /speedtest/* {
        uri strip_prefix /speedtest
        reverse_proxy speedtest:8989
    }
}

http://ftp.sjtu.edu.cn/ {
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    redir / https://ftp.sjtu.edu.cn/ 308
}

http://ftp.sjtu.edu.cn/centos {
    redir /centos /centos/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://ftp.sjtu.edu.cn/centos/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://ftp.sjtu.edu.cn/debian {
    redir /debian /debian/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://ftp.sjtu.edu.cn/debian/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://ftp.sjtu.edu.cn/debian-security {
    redir /debian-security /debian-security/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://ftp.sjtu.edu.cn/debian-security/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://ftp.sjtu.edu.cn/deepin {
    redir /deepin /deepin/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://ftp.sjtu.edu.cn/deepin/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://ftp.sjtu.edu.cn/docker-ce {
    redir /docker-ce /docker-ce/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://ftp.sjtu.edu.cn/docker-ce/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk2
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://ftp.sjtu.edu.cn/fedora-secondary {
    redir /fedora-secondary /fedora-secondary/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://ftp.sjtu.edu.cn/fedora-secondary/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://ftp.sjtu.edu.cn/opensuse {
    redir /opensuse /opensuse/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://ftp.sjtu.edu.cn/opensuse/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://ftp.sjtu.edu.cn/remi {
    redir /remi /remi/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://ftp.sjtu.edu.cn/remi/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk2
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://ftp.sjtu.edu.cn/ubuntu {
    redir /ubuntu /ubuntu/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://ftp.sjtu.edu.cn/ubuntu/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk2
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://ftp.sjtu.edu.cn/ubuntu-ports {
    redir /ubuntu-ports /ubuntu-ports/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://ftp.sjtu.edu.cn/ubuntu-ports/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk2
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://ftp.sjtu.edu.cn/openwrt {
    redir /openwrt /openwrt/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://ftp.sjtu.edu.cn/openwrt/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://ftp.sjtu.edu.cn/rpmfusion {
    redir /rpmfusion /rpmfusion/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://ftp.sjtu.edu.cn/rpmfusion/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://ftp.sjtu.edu.cn/fedora {
    redir /fedora /fedora/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://ftp.sjtu.edu.cn/fedora/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

ftp.sjtu.edu.cn {
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }

    file_server /* {
        root /dists
    }
    rewrite /docs/* /  # for react app

    reverse_proxy /lug/* lug:7001 {
        header_down Access-Control-Allow-Origin *
        header_down Access-Control-Request-Method GET
    }

    basicauth /monitor/* {
        {$MONITOR_USER} {$MONITOR_PASSWORD_HASHED}
    }
    route /monitor/node_exporter/* {
        uri strip_prefix /monitor/node_exporter
        reverse_proxy 172.31.0.1:9100
    }
    route /monitor/cadvisor/* {
        uri strip_prefix /monitor/cadvisor
        reverse_proxy cadvisor:8080
    }
    route /monitor/lug/* {
        uri strip_prefix /monitor/lug
        reverse_proxy lug:8081
    }
    route /monitor/mirror-intel/* {
        uri strip_prefix /monitor/mirror-intel
        reverse_proxy mirror-intel:8000
    }
    route /monitor/docker-gcr/* {
        uri strip_prefix /monitor/docker-gcr
        reverse_proxy siyuan-gcr-registry:5001
    }
    route /monitor/docker-registry/* {
        uri strip_prefix /monitor/docker-registry
        reverse_proxy siyuan-docker-registry:5001
    }

    @hidden {
        path */.*
    }
    respond @hidden 404
    @reject_lug_api {
        path /lug/v1/admin/*
    }
    respond @reject_lug_api 403

    header * x-sjtug-mirror-id siyuan
    header /mirrorz/* Access-Control-Allow-Origin *
    header /mirrorz/* Access-Control-Request-Method GET

    redir /centos /centos/ 301
    file_server /centos/* browse {
        root /srv/disk1
        hide .*
    }
    redir /debian /debian/ 301
    file_server /debian/* browse {
        root /srv/disk1
        hide .*
    }
    redir /debian-cd /debian-cd/ 301
    file_server /debian-cd/* browse {
        root /srv/disk1
        hide .*
    }
    redir /debian-security /debian-security/ 301
    file_server /debian-security/* browse {
        root /srv/disk1
        hide .*
    }
    redir /deepin /deepin/ 301
    file_server /deepin/* browse {
        root /srv/disk1
        hide .*
    }
    redir /deepin-cd /deepin-cd/ 301
    file_server /deepin-cd/* browse {
        root /srv/disk1
        hide .*
    }
    redir /docker-ce /docker-ce/ 301
    file_server /docker-ce/* browse {
        root /srv/disk2
        hide .*
    }
    redir /fedora-secondary /fedora-secondary/ 301
    file_server /fedora-secondary/* browse {
        root /srv/disk1
        hide .*
    }
    redir /linuxmint /linuxmint/ 301
    file_server /linuxmint/* browse {
        root /srv/disk1
        hide .*
    }
    redir /linuxmint-cd /linuxmint-cd/ 301
    file_server /linuxmint-cd/* browse {
        root /srv/disk1
        hide .*
    }
    redir /mageia /mageia/ 301
    file_server /mageia/* browse {
        root /srv/disk2
        hide .*
    }
    redir /opensuse /opensuse/ 301
    file_server /opensuse/* browse {
        root /srv/disk1
        hide .*
    }
    redir /openvz /openvz/ 301
    file_server /openvz/* browse {
        root /srv/disk2
        hide .*
    }
    redir /remi /remi/ 301
    file_server /remi/* browse {
        root /srv/disk2
        hide .*
    }
    redir /scientific /scientific/ 301
    file_server /scientific/* browse {
        root /srv/disk2
        hide .*
    }
    redir /ubuntu /ubuntu/ 301
    file_server /ubuntu/* browse {
        root /srv/disk2
        hide .*
    }
    redir /ubuntu-cd /ubuntu-cd/ 301
    file_server /ubuntu-cd/* browse {
        root /srv/disk2
        hide .*
    }
    redir /ubuntu-cdimage /ubuntu-cdimage/ 301
    file_server /ubuntu-cdimage/* browse {
        root /srv/disk2
        hide .*
    }
    redir /ubuntu-ports /ubuntu-ports/ 301
    file_server /ubuntu-ports/* browse {
        root /srv/disk2
        hide .*
    }
    redir /openwrt /openwrt/ 301
    file_server /openwrt/* browse {
        root /srv/disk1
        hide .*
    }
    redir /rpmfusion /rpmfusion/ 301
    file_server /rpmfusion/* browse {
        root /srv/disk1
        hide .*
    }
    redir /homebrew-bottles /homebrew-bottles/ 301
    route /homebrew-bottles/* {
        reverse_proxy mirror-intel:8000
    }
    redir /rust-static /rust-static/ 301
    route /rust-static/* {
        reverse_proxy mirror-intel:8000
    }
    redir /pypi-packages /pypi-packages/ 301
    route /pypi-packages/* {
        reverse_proxy mirror-intel:8000
    }
    redir /dart-pub /dart-pub/ 301
    route /dart-pub/* {
        reverse_proxy mirror-intel:8000
    }
    redir /pytorch-wheels /pytorch-wheels/ 301
    route /pytorch-wheels/* {
        reverse_proxy mirror-intel:8000
    }
    redir /crates.io /crates.io/ 301
    route /crates.io/* {
        reverse_proxy mirror-intel:8000
    }
    redir /flutter_infra /flutter_infra/ 301
    route /flutter_infra/* {
        reverse_proxy mirror-intel:8000
    }
    redir /git/linuxbrew-core.git /git/linuxbrew-core.git/ 301
    redir /git/homebrew-services.git /git/homebrew-services.git/ 301
    redir /git/homebrew-cask-drivers.git /git/homebrew-cask-drivers.git/ 301
    redir /git/homebrew-cask-fonts.git /git/homebrew-cask-fonts.git/ 301
    redir /git/homebrew-cask-versions.git /git/homebrew-cask-versions.git/ 301
    redir /linuxbrew-bottles /linuxbrew-bottles/ 301
    route /linuxbrew-bottles/* {
        reverse_proxy mirror-intel:8000
    }
    redir /git/guix.git /git/guix.git/ 301
    redir /git/llvm-project.git /git/llvm-project.git/ 301
    redir /git/flutter-sdk.git /git/flutter-sdk.git/ 301
    redir /apache /apache/ 301
    file_server /apache/* browse {
        root /srv/disk2
        hide .*
    }
    redir /git/ohmyzsh.git /git/ohmyzsh.git/ 301
    redir /git/spacemacs.git /git/spacemacs.git/ 301
    redir /git/doom-emacs.git /git/doom-emacs.git/ 301
    redir /blackarch /blackarch/ 301
    file_server /blackarch/* browse {
        root /srv/disk2
        hide .*
    }
    redir /github/GNS3 /github/GNS3/ 301
    route /github/GNS3/* {
        uri strip_prefix /github/GNS3
        redir * /github-release/GNS3/gns3-gui/releases/download/?mirror_intel_list 302
    }
    redir /github/FreeCAD /github/FreeCAD/ 301
    route /github/FreeCAD/* {
        uri strip_prefix /github/FreeCAD
        redir * /github-release/FreeCAD/FreeCAD/releases/download/?mirror_intel_list 302
    }
    redir /github/prometheus /github/prometheus/ 301
    route /github/prometheus/* {
        uri strip_prefix /github/prometheus
        redir * /github-release/prometheus/?mirror_intel_list 302
    }
    redir /github/rubyinstaller2 /github/rubyinstaller2/ 301
    route /github/rubyinstaller2/* {
        uri strip_prefix /github/rubyinstaller2
        redir * /github-release/oneclick/rubyinstaller2/releases/download/?mirror_intel_list 302
    }
    redir /github/PowerShell /github/PowerShell/ 301
    route /github/PowerShell/* {
        uri strip_prefix /github/PowerShell
        redir * /github-release/PowerShell/PowerShell/releases/download/?mirror_intel_list 302
    }
    redir /sites/tldp.org /sites/tldp.org/ 301
    file_server /sites/tldp.org/* browse {
        root /srv/disk1
        hide .*
    }
    redir /nix-channels/store /nix-channels/store/ 301
    route /nix-channels/store/* {
        reverse_proxy mirror-intel:8000
    }
    redir /guix /guix/ 301
    route /guix/* {
        reverse_proxy mirror-intel:8000
    }
    redir /sjtug-internal /sjtug-internal/ 301
    route /sjtug-internal/* {
        reverse_proxy mirror-intel:8000
    }
    redir /fedora-ostree /fedora-ostree/ 301
    route /fedora-ostree/* {
        reverse_proxy mirror-intel:8000
    }
    redir /fedora-iot /fedora-iot/ 301
    route /fedora-iot/* {
        reverse_proxy mirror-intel:8000
    }
    redir /flathub /flathub/ 301
    route /flathub/* {
        reverse_proxy mirror-intel:8000
    }
    redir /github-release /github-release/ 301
    route /github-release/* {
        reverse_proxy mirror-intel:8000
    }
    redir /npm-registry /npm-registry/ 301
    route /npm-registry/* {
        uri strip_prefix /npm-registry
        redir * https://registry.npmjs.org{uri} 302
    }
    redir /nodejs-release /nodejs-release/ 301
    route /nodejs-release/* {
        uri strip_prefix /nodejs-release
        redir * https://nodejs.org/dist{uri} 302
    }
    redir /maven-central /maven-central/ 301
    route /maven-central/* {
        uri strip_prefix /maven-central
        redir * https://repo.maven.apache.org/maven2{uri} 302
    }
    redir /gcr-registry-siyuan /gcr-registry-siyuan/ 301
    route /gcr-registry-siyuan/* {
        uri strip_prefix /gcr-registry-siyuan
        reverse_proxy siyuan-gcr-registry:80 {
            header_up Host {http.reverse_proxy.upstream.hostport}
        }
    }
    redir /docker-registry-siyuan /docker-registry-siyuan/ 301
    route /docker-registry-siyuan/* {
        uri strip_prefix /docker-registry-siyuan
        reverse_proxy siyuan-docker-registry:80 {
            header_up Host {http.reverse_proxy.upstream.hostport}
        }
    }
    redir /sury /sury/ 301
    file_server /sury/* browse {
        root /srv/disk1
        hide .*
    }
    redir /opam-cache /opam-cache/ 301
    route /opam-cache/* {
        reverse_proxy mirror-intel:8000
    }
    redir /pypi/web/simple /pypi/web/simple/ 301
    route /pypi/web/simple/* {
        reverse_proxy mirror-intel:8000
    }
    redir /git/dpdk.git /git/dpdk.git/ 301
    redir /gradle/distributions /gradle/distributions/ 301
    route /gradle/distributions/* {
        reverse_proxy mirror-intel:8000
    }
    redir /dragonflybsd /dragonflybsd/ 301
    file_server /dragonflybsd/* browse {
        root /srv/disk2
        hide .*
    }
    redir /git/homebrew-install.git /git/homebrew-install.git/ 301
    redir /openeuler /openeuler/ 301
    file_server /openeuler/* browse {
        root /srv/disk1
        hide .*
    }
    redir /fedora /fedora/ 301
    file_server /fedora/* browse {
        root /srv/disk1
        hide .*
    }
    redir /manjaro /manjaro/ 301
    file_server /manjaro/* browse {
        root /srv/disk2
        hide .*
    }
    redir /manjarostable /manjarostable/ 301
    route /manjarostable/* {
        uri strip_prefix /manjarostable
        redir * https://mirror.sjtu.edu.cn/manjaro/stable{uri} 302
    }
    redir /voidlinux /voidlinux/ 301
    route /voidlinux/* {
        reverse_proxy mirror-intel:8000
    }
    redir /archlinux /archlinux/ 301
    file_server /archlinux/* browse {
        root /srv/disk2
        hide .*
    }
    redir /bioconductor /bioconductor/ 301
    route /bioconductor/* {
        reverse_proxy mirror-intel:8000
    }
    redir /wireshark /wireshark/ 301
    route /wireshark/* {
        reverse_proxy mirror-intel:8000
    }
    redir /test /test/ 301
    file_server /test/* browse {
        root /srv/disk1
        hide .*
    }
    redir /macports /macports/ 301
    route /macports/* {
        reverse_proxy mirror-intel:8000
    }
    redir /github/vscodium /github/vscodium/ 301
    route /github/vscodium/* {
        uri strip_prefix /github/vscodium
        redir * /github-release/VSCodium/vscodium/releases/download/?mirror_intel_list 302
    }
    redir /gimp /gimp/ 301
    route /gimp/* {
        reverse_proxy mirror-intel:8000
    }
    redir /flutter_infra_release /flutter_infra_release/ 301
    route /flutter_infra_release/* {
        uri strip_prefix /flutter_infra_release
        redir * https://mirror.sjtu.edu.cn/flutter_infra{uri} 302
    }
    redir /anaconda /anaconda/ 301
    route /anaconda/* {
        reverse_proxy mirror-intel:8000
    }
    redir /putty /putty/ 301
    route /putty/* {
        uri strip_prefix /putty
        redir * https://mirrors.sjtug.sjtu.edu.cn/putty{uri} 302
    }
    redir /archlinux-cn /archlinux-cn/ 301
    route /archlinux-cn/* {
        uri strip_prefix /archlinux-cn
        redir * https://mirrors.sjtug.sjtu.edu.cn/archlinux-cn{uri} 302
    }
    redir /archlinuxarm /archlinuxarm/ 301
    route /archlinuxarm/* {
        uri strip_prefix /archlinuxarm
        redir * https://mirrors.sjtug.sjtu.edu.cn/archlinuxarm{uri} 302
    }
    redir /gentoo /gentoo/ 301
    route /gentoo/* {
        uri strip_prefix /gentoo
        redir * https://mirrors.sjtug.sjtu.edu.cn/gentoo{uri} 302
    }
    redir /vim /vim/ 301
    route /vim/* {
        uri strip_prefix /vim
        redir * https://mirrors.sjtug.sjtu.edu.cn/vim{uri} 302
    }
    redir /alpine /alpine/ 301
    route /alpine/* {
        uri strip_prefix /alpine
        redir * https://mirrors.sjtug.sjtu.edu.cn/alpine{uri} 302
    }
    redir /cpan /cpan/ 301
    route /cpan/* {
        uri strip_prefix /cpan
        redir * https://mirrors.sjtug.sjtu.edu.cn/cpan{uri} 302
    }
    redir /cran /cran/ 301
    route /cran/* {
        uri strip_prefix /cran
        redir * https://mirrors.sjtug.sjtu.edu.cn/cran{uri} 302
    }
    redir /ctex /ctex/ 301
    route /ctex/* {
        uri strip_prefix /ctex
        redir * https://mirrors.sjtug.sjtu.edu.cn/ctex{uri} 302
    }
    redir /gnu /gnu/ 301
    route /gnu/* {
        uri strip_prefix /gnu
        redir * https://mirrors.sjtug.sjtu.edu.cn/gnu{uri} 302
    }
    redir /cygwin /cygwin/ 301
    route /cygwin/* {
        uri strip_prefix /cygwin
        redir * https://mirrors.sjtug.sjtu.edu.cn/cygwin{uri} 302
    }
    redir /ros /ros/ 301
    route /ros/* {
        uri strip_prefix /ros
        redir * https://mirrors.sjtug.sjtu.edu.cn/ros{uri} 302
    }
    redir /kali /kali/ 301
    route /kali/* {
        uri strip_prefix /kali
        redir * https://mirrors.sjtug.sjtu.edu.cn/kali{uri} 302
    }
    redir /kali-images /kali-images/ 301
    route /kali-images/* {
        uri strip_prefix /kali-images
        redir * https://mirrors.sjtug.sjtu.edu.cn/kali-images{uri} 302
    }
    redir /git/homebrew-core.git /git/homebrew-core.git/ 301
    redir /git/homebrew-cask.git /git/homebrew-cask.git/ 301
    redir /git/brew.git /git/brew.git/ 301
    redir /git/crates.io-index /git/crates.io-index/ 301
    redir /raspbian /raspbian/ 301
    route /raspbian/* {
        uri strip_prefix /raspbian
        redir * https://mirrors.sjtug.sjtu.edu.cn/raspbian{uri} 302
    }
    redir /parrot /parrot/ 301
    route /parrot/* {
        uri strip_prefix /parrot
        redir * https://mirrors.sjtug.sjtu.edu.cn/parrot{uri} 302
    }
    redir /raspberrypi /raspberrypi/ 301
    route /raspberrypi/* {
        uri strip_prefix /raspberrypi
        redir * https://mirrors.sjtug.sjtu.edu.cn/raspberrypi{uri} 302
    }
    redir /mx-isos /mx-isos/ 301
    route /mx-isos/* {
        uri strip_prefix /mx-isos
        redir * https://mirrors.sjtug.sjtu.edu.cn/mx-isos{uri} 302
    }
    redir /mx-packages /mx-packages/ 301
    route /mx-packages/* {
        uri strip_prefix /mx-packages
        redir * https://mirrors.sjtug.sjtu.edu.cn/mx-packages{uri} 302
    }
    redir /packagist /packagist/ 301
    route /packagist/* {
        uri strip_prefix /packagist
        redir * https://mirrors.sjtug.sjtu.edu.cn/packagist{uri} 302
    }
    redir /mongodb /mongodb/ 301
    route /mongodb/* {
        uri strip_prefix /mongodb
        redir * https://mirrors.sjtug.sjtu.edu.cn/mongodb{uri} 302
    }
    redir /qt /qt/ 301
    route /qt/* {
        uri strip_prefix /qt
        redir * https://mirrors.sjtug.sjtu.edu.cn/qt{uri} 302
    }
    redir /julia /julia/ 301
    route /julia/* {
        uri strip_prefix /julia
        redir * https://mirrors.sjtug.sjtu.edu.cn/julia{uri} 302
    }
    redir /emacs-elpa /emacs-elpa/ 301
    route /emacs-elpa/* {
        uri strip_prefix /emacs-elpa
        redir * https://mirrors.sjtug.sjtu.edu.cn/emacs-elpa{uri} 302
    }
    redir /julia-releases /julia-releases/ 301
    route /julia-releases/* {
        uri strip_prefix /julia-releases
        redir * https://mirrors.sjtug.sjtu.edu.cn/julia-releases{uri} 302
    }
    redir /raspberry-pi-os-images /raspberry-pi-os-images/ 301
    route /raspberry-pi-os-images/* {
        uri strip_prefix /raspberry-pi-os-images
        redir * https://mirrors.sjtug.sjtu.edu.cn/raspberry-pi-os-images{uri} 302
    }
    redir /msys2 /msys2/ 301
    route /msys2/* {
        uri strip_prefix /msys2
        redir * https://mirrors.sjtug.sjtu.edu.cn/msys2{uri} 302
    }
    redir /git/opam-repository.git /git/opam-repository.git/ 301
    redir /git/qemu.git /git/qemu.git/ 301
    redir /git/linux.git /git/linux.git/ 301
    redir /linuxliteos /linuxliteos/ 301
    route /linuxliteos/* {
        uri strip_prefix /linuxliteos
        redir * https://mirrors.sjtug.sjtu.edu.cn/linuxliteos{uri} 302
    }
    redir /download.flutter.io /download.flutter.io/ 301
    route /download.flutter.io/* {
        uri strip_prefix /download.flutter.io
        redir * https://mirrors.sjtug.sjtu.edu.cn/download.flutter.io{uri} 302
    }
    redir /google-fonts /google-fonts/ 301
    route /google-fonts/* {
        uri strip_prefix /google-fonts
        redir * https://fonts.googleapis.com{uri} 302
    }
    redir /CPAN /CPAN/ 301
    route /CPAN/* {
        uri strip_prefix /CPAN
        redir * https://mirrors.sjtug.sjtu.edu.cn/CPAN{uri} 302
    }
    redir /CRAN /CRAN/ 301
    route /CRAN/* {
        uri strip_prefix /CRAN
        redir * https://mirrors.sjtug.sjtu.edu.cn/CRAN{uri} 302
    }
    redir /CTAN /CTAN/ 301
    route /CTAN/* {
        uri strip_prefix /CTAN
        redir * https://mirrors.sjtug.sjtu.edu.cn/CTAN{uri} 302
    }
    redir /ctan /ctan/ 301
    route /ctan/* {
        uri strip_prefix /ctan
        redir * https://mirrors.sjtug.sjtu.edu.cn/ctan{uri} 302
    }

    @git_libgit2 {
        path /git/*
        header User-Agent *libgit2*
    }
    reverse_proxy @git_libgit2 git-backend
    @git_normal {
        path /git/*
        not header User-Agent *libgit2*
    }
    route @git_normal {
        route /git/linuxbrew-core.git/* {
            reverse_proxy git-backend
        }
        route /git/homebrew-services.git/* {
            reverse_proxy git-backend
        }
        route /git/homebrew-cask-drivers.git/* {
            reverse_proxy git-backend
        }
        route /git/homebrew-cask-fonts.git/* {
            reverse_proxy git-backend
        }
        route /git/homebrew-cask-versions.git/* {
            reverse_proxy git-backend
        }
        route /git/guix.git/* {
            reverse_proxy git-backend
        }
        route /git/llvm-project.git/* {
            reverse_proxy git-backend
        }
        route /git/flutter-sdk.git/* {
            reverse_proxy git-backend
        }
        route /git/ohmyzsh.git/* {
            reverse_proxy git-backend
        }
        route /git/spacemacs.git/* {
            reverse_proxy git-backend
        }
        route /git/doom-emacs.git/* {
            reverse_proxy git-backend
        }
        route /git/dpdk.git/* {
            reverse_proxy git-backend
        }
        route /git/homebrew-install.git/* {
            reverse_proxy git-backend
        }
        route /git/homebrew-core.git/* {
            uri strip_prefix /git/homebrew-core.git
            redir * https://mirrors.sjtug.sjtu.edu.cn/git/homebrew-core.git{uri} 302
        }
        route /git/homebrew-cask.git/* {
            uri strip_prefix /git/homebrew-cask.git
            redir * https://mirrors.sjtug.sjtu.edu.cn/git/homebrew-cask.git{uri} 302
        }
        route /git/brew.git/* {
            uri strip_prefix /git/brew.git
            redir * https://mirrors.sjtug.sjtu.edu.cn/git/brew.git{uri} 302
        }
        route /git/crates.io-index/* {
            uri strip_prefix /git/crates.io-index
            redir * https://mirrors.sjtug.sjtu.edu.cn/git/crates.io-index{uri} 302
        }
        route /git/opam-repository.git/* {
            uri strip_prefix /git/opam-repository.git
            redir * https://mirrors.sjtug.sjtu.edu.cn/git/opam-repository.git{uri} 302
        }
        route /git/qemu.git/* {
            uri strip_prefix /git/qemu.git
            redir * https://mirrors.sjtug.sjtu.edu.cn/git/qemu.git{uri} 302
        }
        route /git/linux.git/* {
            uri strip_prefix /git/linux.git
            redir * https://mirrors.sjtug.sjtu.edu.cn/git/linux.git{uri} 302
        }
    }
    @gzip_enabled {
        not path /speedtest/*
        not path /homebrew-bottles/*
        not path /rust-static/*
        not path /pypi-packages/*
        not path /dart-pub/*
        not path /pytorch-wheels/*
        not path /crates.io/*
        not path /flutter_infra/*
        not path /git/linuxbrew-core.git/*
        not path /git/homebrew-services.git/*
        not path /git/homebrew-cask-drivers.git/*
        not path /git/homebrew-cask-fonts.git/*
        not path /git/homebrew-cask-versions.git/*
        not path /linuxbrew-bottles/*
        not path /git/guix.git/*
        not path /git/llvm-project.git/*
        not path /git/flutter-sdk.git/*
        not path /git/ohmyzsh.git/*
        not path /git/spacemacs.git/*
        not path /git/doom-emacs.git/*
        not path /github/GNS3/*
        not path /github/FreeCAD/*
        not path /github/prometheus/*
        not path /github/rubyinstaller2/*
        not path /github/PowerShell/*
        not path /nix-channels/store/*
        not path /guix/*
        not path /sjtug-internal/*
        not path /fedora-ostree/*
        not path /fedora-iot/*
        not path /flathub/*
        not path /github-release/*
        not path /npm-registry/*
        not path /nodejs-release/*
        not path /maven-central/*
        not path /gcr-registry-siyuan/*
        not path /docker-registry-siyuan/*
        not path /opam-cache/*
        not path /pypi/web/simple/*
        not path /git/dpdk.git/*
        not path /gradle/distributions/*
        not path /git/homebrew-install.git/*
        not path /manjarostable/*
        not path /voidlinux/*
        not path /bioconductor/*
        not path /wireshark/*
        not path /macports/*
        not path /github/vscodium/*
        not path /gimp/*
        not path /flutter_infra_release/*
        not path /anaconda/*
        not path /putty/*
        not path /archlinux-cn/*
        not path /archlinuxarm/*
        not path /gentoo/*
        not path /vim/*
        not path /alpine/*
        not path /cpan/*
        not path /cran/*
        not path /ctex/*
        not path /gnu/*
        not path /cygwin/*
        not path /ros/*
        not path /kali/*
        not path /kali-images/*
        not path /git/homebrew-core.git/*
        not path /git/homebrew-cask.git/*
        not path /git/brew.git/*
        not path /git/crates.io-index/*
        not path /raspbian/*
        not path /parrot/*
        not path /raspberrypi/*
        not path /mx-isos/*
        not path /mx-packages/*
        not path /packagist/*
        not path /mongodb/*
        not path /qt/*
        not path /julia/*
        not path /emacs-elpa/*
        not path /julia-releases/*
        not path /raspberry-pi-os-images/*
        not path /msys2/*
        not path /git/opam-repository.git/*
        not path /git/qemu.git/*
        not path /git/linux.git/*
        not path /linuxliteos/*
        not path /download.flutter.io/*
        not path /google-fonts/*
        not path /CPAN/*
        not path /CRAN/*
        not path /CTAN/*
        not path /ctan/*
    }
    encode @gzip_enabled gzip zstd
    redir /speedtest /speedtest/ 308
    route /speedtest/* {
        uri strip_prefix /speedtest
        reverse_proxy speedtest:8989
    }
}

http://ftp6.sjtu.edu.cn/ {
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    redir / https://ftp6.sjtu.edu.cn/ 308
}

http://ftp6.sjtu.edu.cn/centos {
    redir /centos /centos/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://ftp6.sjtu.edu.cn/centos/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://ftp6.sjtu.edu.cn/debian {
    redir /debian /debian/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://ftp6.sjtu.edu.cn/debian/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://ftp6.sjtu.edu.cn/debian-security {
    redir /debian-security /debian-security/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://ftp6.sjtu.edu.cn/debian-security/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://ftp6.sjtu.edu.cn/deepin {
    redir /deepin /deepin/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://ftp6.sjtu.edu.cn/deepin/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://ftp6.sjtu.edu.cn/docker-ce {
    redir /docker-ce /docker-ce/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://ftp6.sjtu.edu.cn/docker-ce/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk2
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://ftp6.sjtu.edu.cn/fedora-secondary {
    redir /fedora-secondary /fedora-secondary/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://ftp6.sjtu.edu.cn/fedora-secondary/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://ftp6.sjtu.edu.cn/opensuse {
    redir /opensuse /opensuse/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://ftp6.sjtu.edu.cn/opensuse/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://ftp6.sjtu.edu.cn/remi {
    redir /remi /remi/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://ftp6.sjtu.edu.cn/remi/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk2
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://ftp6.sjtu.edu.cn/ubuntu {
    redir /ubuntu /ubuntu/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://ftp6.sjtu.edu.cn/ubuntu/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk2
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://ftp6.sjtu.edu.cn/ubuntu-ports {
    redir /ubuntu-ports /ubuntu-ports/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://ftp6.sjtu.edu.cn/ubuntu-ports/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk2
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://ftp6.sjtu.edu.cn/openwrt {
    redir /openwrt /openwrt/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://ftp6.sjtu.edu.cn/openwrt/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://ftp6.sjtu.edu.cn/rpmfusion {
    redir /rpmfusion /rpmfusion/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://ftp6.sjtu.edu.cn/rpmfusion/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://ftp6.sjtu.edu.cn/fedora {
    redir /fedora /fedora/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://ftp6.sjtu.edu.cn/fedora/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

ftp6.sjtu.edu.cn {
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }

    file_server /* {
        root /dists
    }
    rewrite /docs/* /  # for react app

    reverse_proxy /lug/* lug:7001 {
        header_down Access-Control-Allow-Origin *
        header_down Access-Control-Request-Method GET
    }

    basicauth /monitor/* {
        {$MONITOR_USER} {$MONITOR_PASSWORD_HASHED}
    }
    route /monitor/node_exporter/* {
        uri strip_prefix /monitor/node_exporter
        reverse_proxy 172.31.0.1:9100
    }
    route /monitor/cadvisor/* {
        uri strip_prefix /monitor/cadvisor
        reverse_proxy cadvisor:8080
    }
    route /monitor/lug/* {
        uri strip_prefix /monitor/lug
        reverse_proxy lug:8081
    }
    route /monitor/mirror-intel/* {
        uri strip_prefix /monitor/mirror-intel
        reverse_proxy mirror-intel:8000
    }
    route /monitor/docker-gcr/* {
        uri strip_prefix /monitor/docker-gcr
        reverse_proxy siyuan-gcr-registry:5001
    }
    route /monitor/docker-registry/* {
        uri strip_prefix /monitor/docker-registry
        reverse_proxy siyuan-docker-registry:5001
    }

    @hidden {
        path */.*
    }
    respond @hidden 404
    @reject_lug_api {
        path /lug/v1/admin/*
    }
    respond @reject_lug_api 403

    header * x-sjtug-mirror-id siyuan
    header /mirrorz/* Access-Control-Allow-Origin *
    header /mirrorz/* Access-Control-Request-Method GET

    redir /centos /centos/ 301
    file_server /centos/* browse {
        root /srv/disk1
        hide .*
    }
    redir /debian /debian/ 301
    file_server /debian/* browse {
        root /srv/disk1
        hide .*
    }
    redir /debian-cd /debian-cd/ 301
    file_server /debian-cd/* browse {
        root /srv/disk1
        hide .*
    }
    redir /debian-security /debian-security/ 301
    file_server /debian-security/* browse {
        root /srv/disk1
        hide .*
    }
    redir /deepin /deepin/ 301
    file_server /deepin/* browse {
        root /srv/disk1
        hide .*
    }
    redir /deepin-cd /deepin-cd/ 301
    file_server /deepin-cd/* browse {
        root /srv/disk1
        hide .*
    }
    redir /docker-ce /docker-ce/ 301
    file_server /docker-ce/* browse {
        root /srv/disk2
        hide .*
    }
    redir /fedora-secondary /fedora-secondary/ 301
    file_server /fedora-secondary/* browse {
        root /srv/disk1
        hide .*
    }
    redir /linuxmint /linuxmint/ 301
    file_server /linuxmint/* browse {
        root /srv/disk1
        hide .*
    }
    redir /linuxmint-cd /linuxmint-cd/ 301
    file_server /linuxmint-cd/* browse {
        root /srv/disk1
        hide .*
    }
    redir /mageia /mageia/ 301
    file_server /mageia/* browse {
        root /srv/disk2
        hide .*
    }
    redir /opensuse /opensuse/ 301
    file_server /opensuse/* browse {
        root /srv/disk1
        hide .*
    }
    redir /openvz /openvz/ 301
    file_server /openvz/* browse {
        root /srv/disk2
        hide .*
    }
    redir /remi /remi/ 301
    file_server /remi/* browse {
        root /srv/disk2
        hide .*
    }
    redir /scientific /scientific/ 301
    file_server /scientific/* browse {
        root /srv/disk2
        hide .*
    }
    redir /ubuntu /ubuntu/ 301
    file_server /ubuntu/* browse {
        root /srv/disk2
        hide .*
    }
    redir /ubuntu-cd /ubuntu-cd/ 301
    file_server /ubuntu-cd/* browse {
        root /srv/disk2
        hide .*
    }
    redir /ubuntu-cdimage /ubuntu-cdimage/ 301
    file_server /ubuntu-cdimage/* browse {
        root /srv/disk2
        hide .*
    }
    redir /ubuntu-ports /ubuntu-ports/ 301
    file_server /ubuntu-ports/* browse {
        root /srv/disk2
        hide .*
    }
    redir /openwrt /openwrt/ 301
    file_server /openwrt/* browse {
        root /srv/disk1
        hide .*
    }
    redir /rpmfusion /rpmfusion/ 301
    file_server /rpmfusion/* browse {
        root /srv/disk1
        hide .*
    }
    redir /homebrew-bottles /homebrew-bottles/ 301
    route /homebrew-bottles/* {
        reverse_proxy mirror-intel:8000
    }
    redir /rust-static /rust-static/ 301
    route /rust-static/* {
        reverse_proxy mirror-intel:8000
    }
    redir /pypi-packages /pypi-packages/ 301
    route /pypi-packages/* {
        reverse_proxy mirror-intel:8000
    }
    redir /dart-pub /dart-pub/ 301
    route /dart-pub/* {
        reverse_proxy mirror-intel:8000
    }
    redir /pytorch-wheels /pytorch-wheels/ 301
    route /pytorch-wheels/* {
        reverse_proxy mirror-intel:8000
    }
    redir /crates.io /crates.io/ 301
    route /crates.io/* {
        reverse_proxy mirror-intel:8000
    }
    redir /flutter_infra /flutter_infra/ 301
    route /flutter_infra/* {
        reverse_proxy mirror-intel:8000
    }
    redir /git/linuxbrew-core.git /git/linuxbrew-core.git/ 301
    redir /git/homebrew-services.git /git/homebrew-services.git/ 301
    redir /git/homebrew-cask-drivers.git /git/homebrew-cask-drivers.git/ 301
    redir /git/homebrew-cask-fonts.git /git/homebrew-cask-fonts.git/ 301
    redir /git/homebrew-cask-versions.git /git/homebrew-cask-versions.git/ 301
    redir /linuxbrew-bottles /linuxbrew-bottles/ 301
    route /linuxbrew-bottles/* {
        reverse_proxy mirror-intel:8000
    }
    redir /git/guix.git /git/guix.git/ 301
    redir /git/llvm-project.git /git/llvm-project.git/ 301
    redir /git/flutter-sdk.git /git/flutter-sdk.git/ 301
    redir /apache /apache/ 301
    file_server /apache/* browse {
        root /srv/disk2
        hide .*
    }
    redir /git/ohmyzsh.git /git/ohmyzsh.git/ 301
    redir /git/spacemacs.git /git/spacemacs.git/ 301
    redir /git/doom-emacs.git /git/doom-emacs.git/ 301
    redir /blackarch /blackarch/ 301
    file_server /blackarch/* browse {
        root /srv/disk2
        hide .*
    }
    redir /github/GNS3 /github/GNS3/ 301
    route /github/GNS3/* {
        uri strip_prefix /github/GNS3
        redir * /github-release/GNS3/gns3-gui/releases/download/?mirror_intel_list 302
    }
    redir /github/FreeCAD /github/FreeCAD/ 301
    route /github/FreeCAD/* {
        uri strip_prefix /github/FreeCAD
        redir * /github-release/FreeCAD/FreeCAD/releases/download/?mirror_intel_list 302
    }
    redir /github/prometheus /github/prometheus/ 301
    route /github/prometheus/* {
        uri strip_prefix /github/prometheus
        redir * /github-release/prometheus/?mirror_intel_list 302
    }
    redir /github/rubyinstaller2 /github/rubyinstaller2/ 301
    route /github/rubyinstaller2/* {
        uri strip_prefix /github/rubyinstaller2
        redir * /github-release/oneclick/rubyinstaller2/releases/download/?mirror_intel_list 302
    }
    redir /github/PowerShell /github/PowerShell/ 301
    route /github/PowerShell/* {
        uri strip_prefix /github/PowerShell
        redir * /github-release/PowerShell/PowerShell/releases/download/?mirror_intel_list 302
    }
    redir /sites/tldp.org /sites/tldp.org/ 301
    file_server /sites/tldp.org/* browse {
        root /srv/disk1
        hide .*
    }
    redir /nix-channels/store /nix-channels/store/ 301
    route /nix-channels/store/* {
        reverse_proxy mirror-intel:8000
    }
    redir /guix /guix/ 301
    route /guix/* {
        reverse_proxy mirror-intel:8000
    }
    redir /sjtug-internal /sjtug-internal/ 301
    route /sjtug-internal/* {
        reverse_proxy mirror-intel:8000
    }
    redir /fedora-ostree /fedora-ostree/ 301
    route /fedora-ostree/* {
        reverse_proxy mirror-intel:8000
    }
    redir /fedora-iot /fedora-iot/ 301
    route /fedora-iot/* {
        reverse_proxy mirror-intel:8000
    }
    redir /flathub /flathub/ 301
    route /flathub/* {
        reverse_proxy mirror-intel:8000
    }
    redir /github-release /github-release/ 301
    route /github-release/* {
        reverse_proxy mirror-intel:8000
    }
    redir /npm-registry /npm-registry/ 301
    route /npm-registry/* {
        uri strip_prefix /npm-registry
        redir * https://registry.npmjs.org{uri} 302
    }
    redir /nodejs-release /nodejs-release/ 301
    route /nodejs-release/* {
        uri strip_prefix /nodejs-release
        redir * https://nodejs.org/dist{uri} 302
    }
    redir /maven-central /maven-central/ 301
    route /maven-central/* {
        uri strip_prefix /maven-central
        redir * https://repo.maven.apache.org/maven2{uri} 302
    }
    redir /gcr-registry-siyuan /gcr-registry-siyuan/ 301
    route /gcr-registry-siyuan/* {
        uri strip_prefix /gcr-registry-siyuan
        reverse_proxy siyuan-gcr-registry:80 {
            header_up Host {http.reverse_proxy.upstream.hostport}
        }
    }
    redir /docker-registry-siyuan /docker-registry-siyuan/ 301
    route /docker-registry-siyuan/* {
        uri strip_prefix /docker-registry-siyuan
        reverse_proxy siyuan-docker-registry:80 {
            header_up Host {http.reverse_proxy.upstream.hostport}
        }
    }
    redir /sury /sury/ 301
    file_server /sury/* browse {
        root /srv/disk1
        hide .*
    }
    redir /opam-cache /opam-cache/ 301
    route /opam-cache/* {
        reverse_proxy mirror-intel:8000
    }
    redir /pypi/web/simple /pypi/web/simple/ 301
    route /pypi/web/simple/* {
        reverse_proxy mirror-intel:8000
    }
    redir /git/dpdk.git /git/dpdk.git/ 301
    redir /gradle/distributions /gradle/distributions/ 301
    route /gradle/distributions/* {
        reverse_proxy mirror-intel:8000
    }
    redir /dragonflybsd /dragonflybsd/ 301
    file_server /dragonflybsd/* browse {
        root /srv/disk2
        hide .*
    }
    redir /git/homebrew-install.git /git/homebrew-install.git/ 301
    redir /openeuler /openeuler/ 301
    file_server /openeuler/* browse {
        root /srv/disk1
        hide .*
    }
    redir /fedora /fedora/ 301
    file_server /fedora/* browse {
        root /srv/disk1
        hide .*
    }
    redir /manjaro /manjaro/ 301
    file_server /manjaro/* browse {
        root /srv/disk2
        hide .*
    }
    redir /manjarostable /manjarostable/ 301
    route /manjarostable/* {
        uri strip_prefix /manjarostable
        redir * https://mirror.sjtu.edu.cn/manjaro/stable{uri} 302
    }
    redir /voidlinux /voidlinux/ 301
    route /voidlinux/* {
        reverse_proxy mirror-intel:8000
    }
    redir /archlinux /archlinux/ 301
    file_server /archlinux/* browse {
        root /srv/disk2
        hide .*
    }
    redir /bioconductor /bioconductor/ 301
    route /bioconductor/* {
        reverse_proxy mirror-intel:8000
    }
    redir /wireshark /wireshark/ 301
    route /wireshark/* {
        reverse_proxy mirror-intel:8000
    }
    redir /test /test/ 301
    file_server /test/* browse {
        root /srv/disk1
        hide .*
    }
    redir /macports /macports/ 301
    route /macports/* {
        reverse_proxy mirror-intel:8000
    }
    redir /github/vscodium /github/vscodium/ 301
    route /github/vscodium/* {
        uri strip_prefix /github/vscodium
        redir * /github-release/VSCodium/vscodium/releases/download/?mirror_intel_list 302
    }
    redir /gimp /gimp/ 301
    route /gimp/* {
        reverse_proxy mirror-intel:8000
    }
    redir /flutter_infra_release /flutter_infra_release/ 301
    route /flutter_infra_release/* {
        uri strip_prefix /flutter_infra_release
        redir * https://mirror.sjtu.edu.cn/flutter_infra{uri} 302
    }
    redir /anaconda /anaconda/ 301
    route /anaconda/* {
        reverse_proxy mirror-intel:8000
    }
    redir /putty /putty/ 301
    route /putty/* {
        uri strip_prefix /putty
        redir * https://mirrors.sjtug.sjtu.edu.cn/putty{uri} 302
    }
    redir /archlinux-cn /archlinux-cn/ 301
    route /archlinux-cn/* {
        uri strip_prefix /archlinux-cn
        redir * https://mirrors.sjtug.sjtu.edu.cn/archlinux-cn{uri} 302
    }
    redir /archlinuxarm /archlinuxarm/ 301
    route /archlinuxarm/* {
        uri strip_prefix /archlinuxarm
        redir * https://mirrors.sjtug.sjtu.edu.cn/archlinuxarm{uri} 302
    }
    redir /gentoo /gentoo/ 301
    route /gentoo/* {
        uri strip_prefix /gentoo
        redir * https://mirrors.sjtug.sjtu.edu.cn/gentoo{uri} 302
    }
    redir /vim /vim/ 301
    route /vim/* {
        uri strip_prefix /vim
        redir * https://mirrors.sjtug.sjtu.edu.cn/vim{uri} 302
    }
    redir /alpine /alpine/ 301
    route /alpine/* {
        uri strip_prefix /alpine
        redir * https://mirrors.sjtug.sjtu.edu.cn/alpine{uri} 302
    }
    redir /cpan /cpan/ 301
    route /cpan/* {
        uri strip_prefix /cpan
        redir * https://mirrors.sjtug.sjtu.edu.cn/cpan{uri} 302
    }
    redir /cran /cran/ 301
    route /cran/* {
        uri strip_prefix /cran
        redir * https://mirrors.sjtug.sjtu.edu.cn/cran{uri} 302
    }
    redir /ctex /ctex/ 301
    route /ctex/* {
        uri strip_prefix /ctex
        redir * https://mirrors.sjtug.sjtu.edu.cn/ctex{uri} 302
    }
    redir /gnu /gnu/ 301
    route /gnu/* {
        uri strip_prefix /gnu
        redir * https://mirrors.sjtug.sjtu.edu.cn/gnu{uri} 302
    }
    redir /cygwin /cygwin/ 301
    route /cygwin/* {
        uri strip_prefix /cygwin
        redir * https://mirrors.sjtug.sjtu.edu.cn/cygwin{uri} 302
    }
    redir /ros /ros/ 301
    route /ros/* {
        uri strip_prefix /ros
        redir * https://mirrors.sjtug.sjtu.edu.cn/ros{uri} 302
    }
    redir /kali /kali/ 301
    route /kali/* {
        uri strip_prefix /kali
        redir * https://mirrors.sjtug.sjtu.edu.cn/kali{uri} 302
    }
    redir /kali-images /kali-images/ 301
    route /kali-images/* {
        uri strip_prefix /kali-images
        redir * https://mirrors.sjtug.sjtu.edu.cn/kali-images{uri} 302
    }
    redir /git/homebrew-core.git /git/homebrew-core.git/ 301
    redir /git/homebrew-cask.git /git/homebrew-cask.git/ 301
    redir /git/brew.git /git/brew.git/ 301
    redir /git/crates.io-index /git/crates.io-index/ 301
    redir /raspbian /raspbian/ 301
    route /raspbian/* {
        uri strip_prefix /raspbian
        redir * https://mirrors.sjtug.sjtu.edu.cn/raspbian{uri} 302
    }
    redir /parrot /parrot/ 301
    route /parrot/* {
        uri strip_prefix /parrot
        redir * https://mirrors.sjtug.sjtu.edu.cn/parrot{uri} 302
    }
    redir /raspberrypi /raspberrypi/ 301
    route /raspberrypi/* {
        uri strip_prefix /raspberrypi
        redir * https://mirrors.sjtug.sjtu.edu.cn/raspberrypi{uri} 302
    }
    redir /mx-isos /mx-isos/ 301
    route /mx-isos/* {
        uri strip_prefix /mx-isos
        redir * https://mirrors.sjtug.sjtu.edu.cn/mx-isos{uri} 302
    }
    redir /mx-packages /mx-packages/ 301
    route /mx-packages/* {
        uri strip_prefix /mx-packages
        redir * https://mirrors.sjtug.sjtu.edu.cn/mx-packages{uri} 302
    }
    redir /packagist /packagist/ 301
    route /packagist/* {
        uri strip_prefix /packagist
        redir * https://mirrors.sjtug.sjtu.edu.cn/packagist{uri} 302
    }
    redir /mongodb /mongodb/ 301
    route /mongodb/* {
        uri strip_prefix /mongodb
        redir * https://mirrors.sjtug.sjtu.edu.cn/mongodb{uri} 302
    }
    redir /qt /qt/ 301
    route /qt/* {
        uri strip_prefix /qt
        redir * https://mirrors.sjtug.sjtu.edu.cn/qt{uri} 302
    }
    redir /julia /julia/ 301
    route /julia/* {
        uri strip_prefix /julia
        redir * https://mirrors.sjtug.sjtu.edu.cn/julia{uri} 302
    }
    redir /emacs-elpa /emacs-elpa/ 301
    route /emacs-elpa/* {
        uri strip_prefix /emacs-elpa
        redir * https://mirrors.sjtug.sjtu.edu.cn/emacs-elpa{uri} 302
    }
    redir /julia-releases /julia-releases/ 301
    route /julia-releases/* {
        uri strip_prefix /julia-releases
        redir * https://mirrors.sjtug.sjtu.edu.cn/julia-releases{uri} 302
    }
    redir /raspberry-pi-os-images /raspberry-pi-os-images/ 301
    route /raspberry-pi-os-images/* {
        uri strip_prefix /raspberry-pi-os-images
        redir * https://mirrors.sjtug.sjtu.edu.cn/raspberry-pi-os-images{uri} 302
    }
    redir /msys2 /msys2/ 301
    route /msys2/* {
        uri strip_prefix /msys2
        redir * https://mirrors.sjtug.sjtu.edu.cn/msys2{uri} 302
    }
    redir /git/opam-repository.git /git/opam-repository.git/ 301
    redir /git/qemu.git /git/qemu.git/ 301
    redir /git/linux.git /git/linux.git/ 301
    redir /linuxliteos /linuxliteos/ 301
    route /linuxliteos/* {
        uri strip_prefix /linuxliteos
        redir * https://mirrors.sjtug.sjtu.edu.cn/linuxliteos{uri} 302
    }
    redir /download.flutter.io /download.flutter.io/ 301
    route /download.flutter.io/* {
        uri strip_prefix /download.flutter.io
        redir * https://mirrors.sjtug.sjtu.edu.cn/download.flutter.io{uri} 302
    }
    redir /google-fonts /google-fonts/ 301
    route /google-fonts/* {
        uri strip_prefix /google-fonts
        redir * https://fonts.googleapis.com{uri} 302
    }
    redir /CPAN /CPAN/ 301
    route /CPAN/* {
        uri strip_prefix /CPAN
        redir * https://mirrors.sjtug.sjtu.edu.cn/CPAN{uri} 302
    }
    redir /CRAN /CRAN/ 301
    route /CRAN/* {
        uri strip_prefix /CRAN
        redir * https://mirrors.sjtug.sjtu.edu.cn/CRAN{uri} 302
    }
    redir /CTAN /CTAN/ 301
    route /CTAN/* {
        uri strip_prefix /CTAN
        redir * https://mirrors.sjtug.sjtu.edu.cn/CTAN{uri} 302
    }
    redir /ctan /ctan/ 301
    route /ctan/* {
        uri strip_prefix /ctan
        redir * https://mirrors.sjtug.sjtu.edu.cn/ctan{uri} 302
    }

    @git_libgit2 {
        path /git/*
        header User-Agent *libgit2*
    }
    reverse_proxy @git_libgit2 git-backend
    @git_normal {
        path /git/*
        not header User-Agent *libgit2*
    }
    route @git_normal {
        route /git/linuxbrew-core.git/* {
            reverse_proxy git-backend
        }
        route /git/homebrew-services.git/* {
            reverse_proxy git-backend
        }
        route /git/homebrew-cask-drivers.git/* {
            reverse_proxy git-backend
        }
        route /git/homebrew-cask-fonts.git/* {
            reverse_proxy git-backend
        }
        route /git/homebrew-cask-versions.git/* {
            reverse_proxy git-backend
        }
        route /git/guix.git/* {
            reverse_proxy git-backend
        }
        route /git/llvm-project.git/* {
            reverse_proxy git-backend
        }
        route /git/flutter-sdk.git/* {
            reverse_proxy git-backend
        }
        route /git/ohmyzsh.git/* {
            reverse_proxy git-backend
        }
        route /git/spacemacs.git/* {
            reverse_proxy git-backend
        }
        route /git/doom-emacs.git/* {
            reverse_proxy git-backend
        }
        route /git/dpdk.git/* {
            reverse_proxy git-backend
        }
        route /git/homebrew-install.git/* {
            reverse_proxy git-backend
        }
        route /git/homebrew-core.git/* {
            uri strip_prefix /git/homebrew-core.git
            redir * https://mirrors.sjtug.sjtu.edu.cn/git/homebrew-core.git{uri} 302
        }
        route /git/homebrew-cask.git/* {
            uri strip_prefix /git/homebrew-cask.git
            redir * https://mirrors.sjtug.sjtu.edu.cn/git/homebrew-cask.git{uri} 302
        }
        route /git/brew.git/* {
            uri strip_prefix /git/brew.git
            redir * https://mirrors.sjtug.sjtu.edu.cn/git/brew.git{uri} 302
        }
        route /git/crates.io-index/* {
            uri strip_prefix /git/crates.io-index
            redir * https://mirrors.sjtug.sjtu.edu.cn/git/crates.io-index{uri} 302
        }
        route /git/opam-repository.git/* {
            uri strip_prefix /git/opam-repository.git
            redir * https://mirrors.sjtug.sjtu.edu.cn/git/opam-repository.git{uri} 302
        }
        route /git/qemu.git/* {
            uri strip_prefix /git/qemu.git
            redir * https://mirrors.sjtug.sjtu.edu.cn/git/qemu.git{uri} 302
        }
        route /git/linux.git/* {
            uri strip_prefix /git/linux.git
            redir * https://mirrors.sjtug.sjtu.edu.cn/git/linux.git{uri} 302
        }
    }
    @gzip_enabled {
        not path /speedtest/*
        not path /homebrew-bottles/*
        not path /rust-static/*
        not path /pypi-packages/*
        not path /dart-pub/*
        not path /pytorch-wheels/*
        not path /crates.io/*
        not path /flutter_infra/*
        not path /git/linuxbrew-core.git/*
        not path /git/homebrew-services.git/*
        not path /git/homebrew-cask-drivers.git/*
        not path /git/homebrew-cask-fonts.git/*
        not path /git/homebrew-cask-versions.git/*
        not path /linuxbrew-bottles/*
        not path /git/guix.git/*
        not path /git/llvm-project.git/*
        not path /git/flutter-sdk.git/*
        not path /git/ohmyzsh.git/*
        not path /git/spacemacs.git/*
        not path /git/doom-emacs.git/*
        not path /github/GNS3/*
        not path /github/FreeCAD/*
        not path /github/prometheus/*
        not path /github/rubyinstaller2/*
        not path /github/PowerShell/*
        not path /nix-channels/store/*
        not path /guix/*
        not path /sjtug-internal/*
        not path /fedora-ostree/*
        not path /fedora-iot/*
        not path /flathub/*
        not path /github-release/*
        not path /npm-registry/*
        not path /nodejs-release/*
        not path /maven-central/*
        not path /gcr-registry-siyuan/*
        not path /docker-registry-siyuan/*
        not path /opam-cache/*
        not path /pypi/web/simple/*
        not path /git/dpdk.git/*
        not path /gradle/distributions/*
        not path /git/homebrew-install.git/*
        not path /manjarostable/*
        not path /voidlinux/*
        not path /bioconductor/*
        not path /wireshark/*
        not path /macports/*
        not path /github/vscodium/*
        not path /gimp/*
        not path /flutter_infra_release/*
        not path /anaconda/*
        not path /putty/*
        not path /archlinux-cn/*
        not path /archlinuxarm/*
        not path /gentoo/*
        not path /vim/*
        not path /alpine/*
        not path /cpan/*
        not path /cran/*
        not path /ctex/*
        not path /gnu/*
        not path /cygwin/*
        not path /ros/*
        not path /kali/*
        not path /kali-images/*
        not path /git/homebrew-core.git/*
        not path /git/homebrew-cask.git/*
        not path /git/brew.git/*
        not path /git/crates.io-index/*
        not path /raspbian/*
        not path /parrot/*
        not path /raspberrypi/*
        not path /mx-isos/*
        not path /mx-packages/*
        not path /packagist/*
        not path /mongodb/*
        not path /qt/*
        not path /julia/*
        not path /emacs-elpa/*
        not path /julia-releases/*
        not path /raspberry-pi-os-images/*
        not path /msys2/*
        not path /git/opam-repository.git/*
        not path /git/qemu.git/*
        not path /git/linux.git/*
        not path /linuxliteos/*
        not path /download.flutter.io/*
        not path /google-fonts/*
        not path /CPAN/*
        not path /CRAN/*
        not path /CTAN/*
        not path /ctan/*
    }
    encode @gzip_enabled gzip zstd
    redir /speedtest /speedtest/ 308
    route /speedtest/* {
        uri strip_prefix /speedtest
        reverse_proxy speedtest:8989
    }
}

http://siyuan.internal.sjtug.org/ {
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    redir / https://siyuan.internal.sjtug.org/ 308
}

http://siyuan.internal.sjtug.org/centos {
    redir /centos /centos/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://siyuan.internal.sjtug.org/centos/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://siyuan.internal.sjtug.org/debian {
    redir /debian /debian/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://siyuan.internal.sjtug.org/debian/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://siyuan.internal.sjtug.org/debian-security {
    redir /debian-security /debian-security/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://siyuan.internal.sjtug.org/debian-security/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://siyuan.internal.sjtug.org/deepin {
    redir /deepin /deepin/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://siyuan.internal.sjtug.org/deepin/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://siyuan.internal.sjtug.org/docker-ce {
    redir /docker-ce /docker-ce/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://siyuan.internal.sjtug.org/docker-ce/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk2
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://siyuan.internal.sjtug.org/fedora-secondary {
    redir /fedora-secondary /fedora-secondary/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://siyuan.internal.sjtug.org/fedora-secondary/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://siyuan.internal.sjtug.org/opensuse {
    redir /opensuse /opensuse/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://siyuan.internal.sjtug.org/opensuse/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://siyuan.internal.sjtug.org/remi {
    redir /remi /remi/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://siyuan.internal.sjtug.org/remi/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk2
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://siyuan.internal.sjtug.org/ubuntu {
    redir /ubuntu /ubuntu/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://siyuan.internal.sjtug.org/ubuntu/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk2
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://siyuan.internal.sjtug.org/ubuntu-ports {
    redir /ubuntu-ports /ubuntu-ports/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://siyuan.internal.sjtug.org/ubuntu-ports/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk2
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://siyuan.internal.sjtug.org/openwrt {
    redir /openwrt /openwrt/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://siyuan.internal.sjtug.org/openwrt/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://siyuan.internal.sjtug.org/rpmfusion {
    redir /rpmfusion /rpmfusion/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://siyuan.internal.sjtug.org/rpmfusion/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

http://siyuan.internal.sjtug.org/fedora {
    redir /fedora /fedora/ 301
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
}

http://siyuan.internal.sjtug.org/fedora/* {
    encode /* gzip zstd
    file_server /* browse {
        root /srv/disk1
        hide .*
    }
    @hidden {
        path */.*
    }
    respond @hidden 404
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }
    header * x-sjtug-mirror-id siyuan
}

siyuan.internal.sjtug.org {
    log {
        output stdout
        format single_field common_log  # log in v1 style
    }

    file_server /* {
        root /dists
    }
    rewrite /docs/* /  # for react app

    reverse_proxy /lug/* lug:7001 {
        header_down Access-Control-Allow-Origin *
        header_down Access-Control-Request-Method GET
    }

    basicauth /monitor/* {
        {$MONITOR_USER} {$MONITOR_PASSWORD_HASHED}
    }
    route /monitor/node_exporter/* {
        uri strip_prefix /monitor/node_exporter
        reverse_proxy 172.31.0.1:9100
    }
    route /monitor/cadvisor/* {
        uri strip_prefix /monitor/cadvisor
        reverse_proxy cadvisor:8080
    }
    route /monitor/lug/* {
        uri strip_prefix /monitor/lug
        reverse_proxy lug:8081
    }
    route /monitor/mirror-intel/* {
        uri strip_prefix /monitor/mirror-intel
        reverse_proxy mirror-intel:8000
    }
    route /monitor/docker-gcr/* {
        uri strip_prefix /monitor/docker-gcr
        reverse_proxy siyuan-gcr-registry:5001
    }
    route /monitor/docker-registry/* {
        uri strip_prefix /monitor/docker-registry
        reverse_proxy siyuan-docker-registry:5001
    }

    @hidden {
        path */.*
    }
    respond @hidden 404
    @reject_lug_api {
        path /lug/v1/admin/*
    }
    respond @reject_lug_api 403

    header * x-sjtug-mirror-id siyuan
    header /mirrorz/* Access-Control-Allow-Origin *
    header /mirrorz/* Access-Control-Request-Method GET

    redir /centos /centos/ 301
    file_server /centos/* browse {
        root /srv/disk1
        hide .*
    }
    redir /debian /debian/ 301
    file_server /debian/* browse {
        root /srv/disk1
        hide .*
    }
    redir /debian-cd /debian-cd/ 301
    file_server /debian-cd/* browse {
        root /srv/disk1
        hide .*
    }
    redir /debian-security /debian-security/ 301
    file_server /debian-security/* browse {
        root /srv/disk1
        hide .*
    }
    redir /deepin /deepin/ 301
    file_server /deepin/* browse {
        root /srv/disk1
        hide .*
    }
    redir /deepin-cd /deepin-cd/ 301
    file_server /deepin-cd/* browse {
        root /srv/disk1
        hide .*
    }
    redir /docker-ce /docker-ce/ 301
    file_server /docker-ce/* browse {
        root /srv/disk2
        hide .*
    }
    redir /fedora-secondary /fedora-secondary/ 301
    file_server /fedora-secondary/* browse {
        root /srv/disk1
        hide .*
    }
    redir /linuxmint /linuxmint/ 301
    file_server /linuxmint/* browse {
        root /srv/disk1
        hide .*
    }
    redir /linuxmint-cd /linuxmint-cd/ 301
    file_server /linuxmint-cd/* browse {
        root /srv/disk1
        hide .*
    }
    redir /mageia /mageia/ 301
    file_server /mageia/* browse {
        root /srv/disk2
        hide .*
    }
    redir /opensuse /opensuse/ 301
    file_server /opensuse/* browse {
        root /srv/disk1
        hide .*
    }
    redir /openvz /openvz/ 301
    file_server /openvz/* browse {
        root /srv/disk2
        hide .*
    }
    redir /remi /remi/ 301
    file_server /remi/* browse {
        root /srv/disk2
        hide .*
    }
    redir /scientific /scientific/ 301
    file_server /scientific/* browse {
        root /srv/disk2
        hide .*
    }
    redir /ubuntu /ubuntu/ 301
    file_server /ubuntu/* browse {
        root /srv/disk2
        hide .*
    }
    redir /ubuntu-cd /ubuntu-cd/ 301
    file_server /ubuntu-cd/* browse {
        root /srv/disk2
        hide .*
    }
    redir /ubuntu-cdimage /ubuntu-cdimage/ 301
    file_server /ubuntu-cdimage/* browse {
        root /srv/disk2
        hide .*
    }
    redir /ubuntu-ports /ubuntu-ports/ 301
    file_server /ubuntu-ports/* browse {
        root /srv/disk2
        hide .*
    }
    redir /openwrt /openwrt/ 301
    file_server /openwrt/* browse {
        root /srv/disk1
        hide .*
    }
    redir /rpmfusion /rpmfusion/ 301
    file_server /rpmfusion/* browse {
        root /srv/disk1
        hide .*
    }
    redir /homebrew-bottles /homebrew-bottles/ 301
    route /homebrew-bottles/* {
        reverse_proxy mirror-intel:8000
    }
    redir /rust-static /rust-static/ 301
    route /rust-static/* {
        reverse_proxy mirror-intel:8000
    }
    redir /pypi-packages /pypi-packages/ 301
    route /pypi-packages/* {
        reverse_proxy mirror-intel:8000
    }
    redir /dart-pub /dart-pub/ 301
    route /dart-pub/* {
        reverse_proxy mirror-intel:8000
    }
    redir /pytorch-wheels /pytorch-wheels/ 301
    route /pytorch-wheels/* {
        reverse_proxy mirror-intel:8000
    }
    redir /crates.io /crates.io/ 301
    route /crates.io/* {
        reverse_proxy mirror-intel:8000
    }
    redir /flutter_infra /flutter_infra/ 301
    route /flutter_infra/* {
        reverse_proxy mirror-intel:8000
    }
    redir /git/linuxbrew-core.git /git/linuxbrew-core.git/ 301
    redir /git/homebrew-services.git /git/homebrew-services.git/ 301
    redir /git/homebrew-cask-drivers.git /git/homebrew-cask-drivers.git/ 301
    redir /git/homebrew-cask-fonts.git /git/homebrew-cask-fonts.git/ 301
    redir /git/homebrew-cask-versions.git /git/homebrew-cask-versions.git/ 301
    redir /linuxbrew-bottles /linuxbrew-bottles/ 301
    route /linuxbrew-bottles/* {
        reverse_proxy mirror-intel:8000
    }
    redir /git/guix.git /git/guix.git/ 301
    redir /git/llvm-project.git /git/llvm-project.git/ 301
    redir /git/flutter-sdk.git /git/flutter-sdk.git/ 301
    redir /apache /apache/ 301
    file_server /apache/* browse {
        root /srv/disk2
        hide .*
    }
    redir /git/ohmyzsh.git /git/ohmyzsh.git/ 301
    redir /git/spacemacs.git /git/spacemacs.git/ 301
    redir /git/doom-emacs.git /git/doom-emacs.git/ 301
    redir /blackarch /blackarch/ 301
    file_server /blackarch/* browse {
        root /srv/disk2
        hide .*
    }
    redir /github/GNS3 /github/GNS3/ 301
    route /github/GNS3/* {
        uri strip_prefix /github/GNS3
        redir * /github-release/GNS3/gns3-gui/releases/download/?mirror_intel_list 302
    }
    redir /github/FreeCAD /github/FreeCAD/ 301
    route /github/FreeCAD/* {
        uri strip_prefix /github/FreeCAD
        redir * /github-release/FreeCAD/FreeCAD/releases/download/?mirror_intel_list 302
    }
    redir /github/prometheus /github/prometheus/ 301
    route /github/prometheus/* {
        uri strip_prefix /github/prometheus
        redir * /github-release/prometheus/?mirror_intel_list 302
    }
    redir /github/rubyinstaller2 /github/rubyinstaller2/ 301
    route /github/rubyinstaller2/* {
        uri strip_prefix /github/rubyinstaller2
        redir * /github-release/oneclick/rubyinstaller2/releases/download/?mirror_intel_list 302
    }
    redir /github/PowerShell /github/PowerShell/ 301
    route /github/PowerShell/* {
        uri strip_prefix /github/PowerShell
        redir * /github-release/PowerShell/PowerShell/releases/download/?mirror_intel_list 302
    }
    redir /sites/tldp.org /sites/tldp.org/ 301
    file_server /sites/tldp.org/* browse {
        root /srv/disk1
        hide .*
    }
    redir /nix-channels/store /nix-channels/store/ 301
    route /nix-channels/store/* {
        reverse_proxy mirror-intel:8000
    }
    redir /guix /guix/ 301
    route /guix/* {
        reverse_proxy mirror-intel:8000
    }
    redir /sjtug-internal /sjtug-internal/ 301
    route /sjtug-internal/* {
        reverse_proxy mirror-intel:8000
    }
    redir /fedora-ostree /fedora-ostree/ 301
    route /fedora-ostree/* {
        reverse_proxy mirror-intel:8000
    }
    redir /fedora-iot /fedora-iot/ 301
    route /fedora-iot/* {
        reverse_proxy mirror-intel:8000
    }
    redir /flathub /flathub/ 301
    route /flathub/* {
        reverse_proxy mirror-intel:8000
    }
    redir /github-release /github-release/ 301
    route /github-release/* {
        reverse_proxy mirror-intel:8000
    }
    redir /npm-registry /npm-registry/ 301
    route /npm-registry/* {
        uri strip_prefix /npm-registry
        redir * https://registry.npmjs.org{uri} 302
    }
    redir /nodejs-release /nodejs-release/ 301
    route /nodejs-release/* {
        uri strip_prefix /nodejs-release
        redir * https://nodejs.org/dist{uri} 302
    }
    redir /maven-central /maven-central/ 301
    route /maven-central/* {
        uri strip_prefix /maven-central
        redir * https://repo.maven.apache.org/maven2{uri} 302
    }
    redir /gcr-registry-siyuan /gcr-registry-siyuan/ 301
    route /gcr-registry-siyuan/* {
        uri strip_prefix /gcr-registry-siyuan
        reverse_proxy siyuan-gcr-registry:80 {
            header_up Host {http.reverse_proxy.upstream.hostport}
        }
    }
    redir /docker-registry-siyuan /docker-registry-siyuan/ 301
    route /docker-registry-siyuan/* {
        uri strip_prefix /docker-registry-siyuan
        reverse_proxy siyuan-docker-registry:80 {
            header_up Host {http.reverse_proxy.upstream.hostport}
        }
    }
    redir /sury /sury/ 301
    file_server /sury/* browse {
        root /srv/disk1
        hide .*
    }
    redir /opam-cache /opam-cache/ 301
    route /opam-cache/* {
        reverse_proxy mirror-intel:8000
    }
    redir /pypi/web/simple /pypi/web/simple/ 301
    route /pypi/web/simple/* {
        reverse_proxy mirror-intel:8000
    }
    redir /git/dpdk.git /git/dpdk.git/ 301
    redir /gradle/distributions /gradle/distributions/ 301
    route /gradle/distributions/* {
        reverse_proxy mirror-intel:8000
    }
    redir /dragonflybsd /dragonflybsd/ 301
    file_server /dragonflybsd/* browse {
        root /srv/disk2
        hide .*
    }
    redir /git/homebrew-install.git /git/homebrew-install.git/ 301
    redir /openeuler /openeuler/ 301
    file_server /openeuler/* browse {
        root /srv/disk1
        hide .*
    }
    redir /fedora /fedora/ 301
    file_server /fedora/* browse {
        root /srv/disk1
        hide .*
    }
    redir /manjaro /manjaro/ 301
    file_server /manjaro/* browse {
        root /srv/disk2
        hide .*
    }
    redir /manjarostable /manjarostable/ 301
    route /manjarostable/* {
        uri strip_prefix /manjarostable
        redir * https://mirror.sjtu.edu.cn/manjaro/stable{uri} 302
    }
    redir /voidlinux /voidlinux/ 301
    route /voidlinux/* {
        reverse_proxy mirror-intel:8000
    }
    redir /archlinux /archlinux/ 301
    file_server /archlinux/* browse {
        root /srv/disk2
        hide .*
    }
    redir /bioconductor /bioconductor/ 301
    route /bioconductor/* {
        reverse_proxy mirror-intel:8000
    }
    redir /wireshark /wireshark/ 301
    route /wireshark/* {
        reverse_proxy mirror-intel:8000
    }
    redir /test /test/ 301
    file_server /test/* browse {
        root /srv/disk1
        hide .*
    }
    redir /macports /macports/ 301
    route /macports/* {
        reverse_proxy mirror-intel:8000
    }
    redir /github/vscodium /github/vscodium/ 301
    route /github/vscodium/* {
        uri strip_prefix /github/vscodium
        redir * /github-release/VSCodium/vscodium/releases/download/?mirror_intel_list 302
    }
    redir /gimp /gimp/ 301
    route /gimp/* {
        reverse_proxy mirror-intel:8000
    }
    redir /flutter_infra_release /flutter_infra_release/ 301
    route /flutter_infra_release/* {
        uri strip_prefix /flutter_infra_release
        redir * https://mirror.sjtu.edu.cn/flutter_infra{uri} 302
    }
    redir /anaconda /anaconda/ 301
    route /anaconda/* {
        reverse_proxy mirror-intel:8000
    }
    redir /putty /putty/ 301
    route /putty/* {
        uri strip_prefix /putty
        redir * https://mirrors.sjtug.sjtu.edu.cn/putty{uri} 302
    }
    redir /archlinux-cn /archlinux-cn/ 301
    route /archlinux-cn/* {
        uri strip_prefix /archlinux-cn
        redir * https://mirrors.sjtug.sjtu.edu.cn/archlinux-cn{uri} 302
    }
    redir /archlinuxarm /archlinuxarm/ 301
    route /archlinuxarm/* {
        uri strip_prefix /archlinuxarm
        redir * https://mirrors.sjtug.sjtu.edu.cn/archlinuxarm{uri} 302
    }
    redir /gentoo /gentoo/ 301
    route /gentoo/* {
        uri strip_prefix /gentoo
        redir * https://mirrors.sjtug.sjtu.edu.cn/gentoo{uri} 302
    }
    redir /vim /vim/ 301
    route /vim/* {
        uri strip_prefix /vim
        redir * https://mirrors.sjtug.sjtu.edu.cn/vim{uri} 302
    }
    redir /alpine /alpine/ 301
    route /alpine/* {
        uri strip_prefix /alpine
        redir * https://mirrors.sjtug.sjtu.edu.cn/alpine{uri} 302
    }
    redir /cpan /cpan/ 301
    route /cpan/* {
        uri strip_prefix /cpan
        redir * https://mirrors.sjtug.sjtu.edu.cn/cpan{uri} 302
    }
    redir /cran /cran/ 301
    route /cran/* {
        uri strip_prefix /cran
        redir * https://mirrors.sjtug.sjtu.edu.cn/cran{uri} 302
    }
    redir /ctex /ctex/ 301
    route /ctex/* {
        uri strip_prefix /ctex
        redir * https://mirrors.sjtug.sjtu.edu.cn/ctex{uri} 302
    }
    redir /gnu /gnu/ 301
    route /gnu/* {
        uri strip_prefix /gnu
        redir * https://mirrors.sjtug.sjtu.edu.cn/gnu{uri} 302
    }
    redir /cygwin /cygwin/ 301
    route /cygwin/* {
        uri strip_prefix /cygwin
        redir * https://mirrors.sjtug.sjtu.edu.cn/cygwin{uri} 302
    }
    redir /ros /ros/ 301
    route /ros/* {
        uri strip_prefix /ros
        redir * https://mirrors.sjtug.sjtu.edu.cn/ros{uri} 302
    }
    redir /kali /kali/ 301
    route /kali/* {
        uri strip_prefix /kali
        redir * https://mirrors.sjtug.sjtu.edu.cn/kali{uri} 302
    }
    redir /kali-images /kali-images/ 301
    route /kali-images/* {
        uri strip_prefix /kali-images
        redir * https://mirrors.sjtug.sjtu.edu.cn/kali-images{uri} 302
    }
    redir /git/homebrew-core.git /git/homebrew-core.git/ 301
    redir /git/homebrew-cask.git /git/homebrew-cask.git/ 301
    redir /git/brew.git /git/brew.git/ 301
    redir /git/crates.io-index /git/crates.io-index/ 301
    redir /raspbian /raspbian/ 301
    route /raspbian/* {
        uri strip_prefix /raspbian
        redir * https://mirrors.sjtug.sjtu.edu.cn/raspbian{uri} 302
    }
    redir /parrot /parrot/ 301
    route /parrot/* {
        uri strip_prefix /parrot
        redir * https://mirrors.sjtug.sjtu.edu.cn/parrot{uri} 302
    }
    redir /raspberrypi /raspberrypi/ 301
    route /raspberrypi/* {
        uri strip_prefix /raspberrypi
        redir * https://mirrors.sjtug.sjtu.edu.cn/raspberrypi{uri} 302
    }
    redir /mx-isos /mx-isos/ 301
    route /mx-isos/* {
        uri strip_prefix /mx-isos
        redir * https://mirrors.sjtug.sjtu.edu.cn/mx-isos{uri} 302
    }
    redir /mx-packages /mx-packages/ 301
    route /mx-packages/* {
        uri strip_prefix /mx-packages
        redir * https://mirrors.sjtug.sjtu.edu.cn/mx-packages{uri} 302
    }
    redir /packagist /packagist/ 301
    route /packagist/* {
        uri strip_prefix /packagist
        redir * https://mirrors.sjtug.sjtu.edu.cn/packagist{uri} 302
    }
    redir /mongodb /mongodb/ 301
    route /mongodb/* {
        uri strip_prefix /mongodb
        redir * https://mirrors.sjtug.sjtu.edu.cn/mongodb{uri} 302
    }
    redir /qt /qt/ 301
    route /qt/* {
        uri strip_prefix /qt
        redir * https://mirrors.sjtug.sjtu.edu.cn/qt{uri} 302
    }
    redir /julia /julia/ 301
    route /julia/* {
        uri strip_prefix /julia
        redir * https://mirrors.sjtug.sjtu.edu.cn/julia{uri} 302
    }
    redir /emacs-elpa /emacs-elpa/ 301
    route /emacs-elpa/* {
        uri strip_prefix /emacs-elpa
        redir * https://mirrors.sjtug.sjtu.edu.cn/emacs-elpa{uri} 302
    }
    redir /julia-releases /julia-releases/ 301
    route /julia-releases/* {
        uri strip_prefix /julia-releases
        redir * https://mirrors.sjtug.sjtu.edu.cn/julia-releases{uri} 302
    }
    redir /raspberry-pi-os-images /raspberry-pi-os-images/ 301
    route /raspberry-pi-os-images/* {
        uri strip_prefix /raspberry-pi-os-images
        redir * https://mirrors.sjtug.sjtu.edu.cn/raspberry-pi-os-images{uri} 302
    }
    redir /msys2 /msys2/ 301
    route /msys2/* {
        uri strip_prefix /msys2
        redir * https://mirrors.sjtug.sjtu.edu.cn/msys2{uri} 302
    }
    redir /git/opam-repository.git /git/opam-repository.git/ 301
    redir /git/qemu.git /git/qemu.git/ 301
    redir /git/linux.git /git/linux.git/ 301
    redir /linuxliteos /linuxliteos/ 301
    route /linuxliteos/* {
        uri strip_prefix /linuxliteos
        redir * https://mirrors.sjtug.sjtu.edu.cn/linuxliteos{uri} 302
    }
    redir /download.flutter.io /download.flutter.io/ 301
    route /download.flutter.io/* {
        uri strip_prefix /download.flutter.io
        redir * https://mirrors.sjtug.sjtu.edu.cn/download.flutter.io{uri} 302
    }
    redir /google-fonts /google-fonts/ 301
    route /google-fonts/* {
        uri strip_prefix /google-fonts
        redir * https://fonts.googleapis.com{uri} 302
    }
    redir /CPAN /CPAN/ 301
    route /CPAN/* {
        uri strip_prefix /CPAN
        redir * https://mirrors.sjtug.sjtu.edu.cn/CPAN{uri} 302
    }
    redir /CRAN /CRAN/ 301
    route /CRAN/* {
        uri strip_prefix /CRAN
        redir * https://mirrors.sjtug.sjtu.edu.cn/CRAN{uri} 302
    }
    redir /CTAN /CTAN/ 301
    route /CTAN/* {
        uri strip_prefix /CTAN
        redir * https://mirrors.sjtug.sjtu.edu.cn/CTAN{uri} 302
    }
    redir /ctan /ctan/ 301
    route /ctan/* {
        uri strip_prefix /ctan
        redir * https://mirrors.sjtug.sjtu.edu.cn/ctan{uri} 302
    }

    @git_libgit2 {
        path /git/*
        header User-Agent *libgit2*
    }
    reverse_proxy @git_libgit2 git-backend
    @git_normal {
        path /git/*
        not header User-Agent *libgit2*
    }
    route @git_normal {
        route /git/linuxbrew-core.git/* {
            reverse_proxy git-backend
        }
        route /git/homebrew-services.git/* {
            reverse_proxy git-backend
        }
        route /git/homebrew-cask-drivers.git/* {
            reverse_proxy git-backend
        }
        route /git/homebrew-cask-fonts.git/* {
            reverse_proxy git-backend
        }
        route /git/homebrew-cask-versions.git/* {
            reverse_proxy git-backend
        }
        route /git/guix.git/* {
            reverse_proxy git-backend
        }
        route /git/llvm-project.git/* {
            reverse_proxy git-backend
        }
        route /git/flutter-sdk.git/* {
            reverse_proxy git-backend
        }
        route /git/ohmyzsh.git/* {
            reverse_proxy git-backend
        }
        route /git/spacemacs.git/* {
            reverse_proxy git-backend
        }
        route /git/doom-emacs.git/* {
            reverse_proxy git-backend
        }
        route /git/dpdk.git/* {
            reverse_proxy git-backend
        }
        route /git/homebrew-install.git/* {
            reverse_proxy git-backend
        }
        route /git/homebrew-core.git/* {
            uri strip_prefix /git/homebrew-core.git
            redir * https://mirrors.sjtug.sjtu.edu.cn/git/homebrew-core.git{uri} 302
        }
        route /git/homebrew-cask.git/* {
            uri strip_prefix /git/homebrew-cask.git
            redir * https://mirrors.sjtug.sjtu.edu.cn/git/homebrew-cask.git{uri} 302
        }
        route /git/brew.git/* {
            uri strip_prefix /git/brew.git
            redir * https://mirrors.sjtug.sjtu.edu.cn/git/brew.git{uri} 302
        }
        route /git/crates.io-index/* {
            uri strip_prefix /git/crates.io-index
            redir * https://mirrors.sjtug.sjtu.edu.cn/git/crates.io-index{uri} 302
        }
        route /git/opam-repository.git/* {
            uri strip_prefix /git/opam-repository.git
            redir * https://mirrors.sjtug.sjtu.edu.cn/git/opam-repository.git{uri} 302
        }
        route /git/qemu.git/* {
            uri strip_prefix /git/qemu.git
            redir * https://mirrors.sjtug.sjtu.edu.cn/git/qemu.git{uri} 302
        }
        route /git/linux.git/* {
            uri strip_prefix /git/linux.git
            redir * https://mirrors.sjtug.sjtu.edu.cn/git/linux.git{uri} 302
        }
    }
    @gzip_enabled {
        not path /speedtest/*
        not path /homebrew-bottles/*
        not path /rust-static/*
        not path /pypi-packages/*
        not path /dart-pub/*
        not path /pytorch-wheels/*
        not path /crates.io/*
        not path /flutter_infra/*
        not path /git/linuxbrew-core.git/*
        not path /git/homebrew-services.git/*
        not path /git/homebrew-cask-drivers.git/*
        not path /git/homebrew-cask-fonts.git/*
        not path /git/homebrew-cask-versions.git/*
        not path /linuxbrew-bottles/*
        not path /git/guix.git/*
        not path /git/llvm-project.git/*
        not path /git/flutter-sdk.git/*
        not path /git/ohmyzsh.git/*
        not path /git/spacemacs.git/*
        not path /git/doom-emacs.git/*
        not path /github/GNS3/*
        not path /github/FreeCAD/*
        not path /github/prometheus/*
        not path /github/rubyinstaller2/*
        not path /github/PowerShell/*
        not path /nix-channels/store/*
        not path /guix/*
        not path /sjtug-internal/*
        not path /fedora-ostree/*
        not path /fedora-iot/*
        not path /flathub/*
        not path /github-release/*
        not path /npm-registry/*
        not path /nodejs-release/*
        not path /maven-central/*
        not path /gcr-registry-siyuan/*
        not path /docker-registry-siyuan/*
        not path /opam-cache/*
        not path /pypi/web/simple/*
        not path /git/dpdk.git/*
        not path /gradle/distributions/*
        not path /git/homebrew-install.git/*
        not path /manjarostable/*
        not path /voidlinux/*
        not path /bioconductor/*
        not path /wireshark/*
        not path /macports/*
        not path /github/vscodium/*
        not path /gimp/*
        not path /flutter_infra_release/*
        not path /anaconda/*
        not path /putty/*
        not path /archlinux-cn/*
        not path /archlinuxarm/*
        not path /gentoo/*
        not path /vim/*
        not path /alpine/*
        not path /cpan/*
        not path /cran/*
        not path /ctex/*
        not path /gnu/*
        not path /cygwin/*
        not path /ros/*
        not path /kali/*
        not path /kali-images/*
        not path /git/homebrew-core.git/*
        not path /git/homebrew-cask.git/*
        not path /git/brew.git/*
        not path /git/crates.io-index/*
        not path /raspbian/*
        not path /parrot/*
        not path /raspberrypi/*
        not path /mx-isos/*
        not path /mx-packages/*
        not path /packagist/*
        not path /mongodb/*
        not path /qt/*
        not path /julia/*
        not path /emacs-elpa/*
        not path /julia-releases/*
        not path /raspberry-pi-os-images/*
        not path /msys2/*
        not path /git/opam-repository.git/*
        not path /git/qemu.git/*
        not path /git/linux.git/*
        not path /linuxliteos/*
        not path /download.flutter.io/*
        not path /google-fonts/*
        not path /CPAN/*
        not path /CRAN/*
        not path /CTAN/*
        not path /ctan/*
    }
    encode @gzip_enabled gzip zstd
    redir /speedtest /speedtest/ 308
    route /speedtest/* {
        uri strip_prefix /speedtest
        reverse_proxy speedtest:8989
    }
}

